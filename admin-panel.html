<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panneau d'Administration - AutoSénégal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Variables et réinitialisation */
        :root {
            --primary-color: #007C5A; /* Vert, couleur du drapeau sénégalais */
            --secondary-color: #FFCE00; /* Jaune, couleur du drapeau sénégalais */
            --accent-color: #CF0921; /* Rouge, couleur du drapeau sénégalais */
            --light: #F5F5F5;
            --dark: #333333;
            --gray: #F0F2F5;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--gray);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: white;
            box-shadow: var(--shadow);
            padding: 20px 0;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .sidebar-logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu-item {
            margin-bottom: 5px;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--dark);
            border-left: 3px solid transparent;
            transition: var(--transition);
        }

        .sidebar-menu-link:hover,
        .sidebar-menu-link.active {
            background-color: rgba(0, 124, 90, 0.1);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .sidebar-menu-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .page-title {
            font-size: 1.8rem;
            color: var(--dark);
        }

        .user-dropdown {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .user-info {
            margin-right: 10px;
            text-align: right;
        }

        .user-name {
            font-weight: 600;
        }

        .user-role {
            font-size: 0.8rem;
            color: #777;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.8rem;
        }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: #777;
            font-size: 0.9rem;
        }

        /* Colored icons */
        .icon-blue {
            background-color: rgba(0, 102, 204, 0.1);
            color: #0066cc;
        }

        .icon-green {
            background-color: rgba(0, 124, 90, 0.1);
            color: var(--primary-color);
        }

        .icon-yellow {
            background-color: rgba(255, 206, 0, 0.1);
            color: var(--secondary-color);
        }

        .icon-red {
            background-color: rgba(207, 9, 33, 0.1);
            color: var(--accent-color);
        }

        /* Sections */
        .section {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .section-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .section-content {
            padding: 20px;
        }

        /* Vehicle Management */
        .control-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background-color: var(--light);
            border-radius: 50px;
            padding: 8px 15px;
            max-width: 400px;
            flex-grow: 1;
        }

        .search-bar input {
            border: none;
            background-color: transparent;
            outline: none;
            padding: 5px 10px;
            width: 100%;
        }

        .search-bar i {
            color: #777;
        }

        .filter-bar {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-dropdown {
            position: relative;
        }

        .filter-btn {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn:hover {
            background-color: var(--light);
        }

        .filter-btn i {
            margin-left: 8px;
        }

        .add-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .add-btn:hover {
            background-color: #006547;
        }

        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .vehicle-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .vehicle-card-header {
            position: relative;
        }

        .vehicle-img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .vehicle-status {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            background-color: white;
        }

        .status-sale {
            background-color: var(--primary-color);
            color: white;
        }

        .status-rent {
            background-color: var(--secondary-color);
            color: var(--dark);
        }

        .vehicle-card-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
            border: none;
        }

        .action-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .vehicle-card-body {
            padding: 15px;
        }

        .vehicle-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .vehicle-price {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .vehicle-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #777;
        }

        .vehicle-detail {
            display: flex;
            align-items: center;
        }

        .vehicle-detail i {
            margin-right: 5px;
        }

        /* Image Upload System */
        .upload-container {
            border: 2px dashed rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            background-color: var(--light);
            transition: var(--transition);
        }

        .upload-container:hover {
            border-color: var(--primary-color);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .upload-text {
            margin-bottom: 20px;
        }

        .upload-text h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .upload-text p {
            color: #777;
        }

        .upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        .upload-btn:hover {
            background-color: #006547;
        }

        .file-input {
            display: none;
        }

        .uploaded-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .uploaded-image {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            height: 120px;
        }

        .uploaded-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-actions {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            opacity: 0;
            transition: var(--transition);
        }

        .uploaded-image:hover .image-actions {
            opacity: 1;
        }

        .image-action {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
            border: none;
        }

        .image-action:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 124, 90, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            background-color: white;
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #006547;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--accent-color);
        }

        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Styles pour la prévisualisation des photos */
        .photo-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .photo-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .preview-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-photo-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .photo-preview-item:hover .remove-photo-btn {
            opacity: 1;
        }

        /* Animation d'ajout de photos */
        @keyframes photoAppear {
            from { 
                opacity: 0; 
                transform: scale(0.8);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }

        .photo-preview-item {
            animation: photoAppear 0.3s ease;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                padding: 20px 0;
            }

            .sidebar-logo {
                padding: 0 10px 20px;
            }

            .sidebar-logo-text {
                display: none;
            }

            .sidebar-menu-link {
                padding: 15px;
                justify-content: center;
            }

            .sidebar-menu-link i {
                margin-right: 0;
                font-size: 1.2rem;
            }

            .sidebar-menu-link span {
                display: none;
            }

            .main-content {
                margin-left: 70px;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            }
        }

        @media (max-width: 576px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 15px;
            }

            .user-info {
                display: none;
            }

            .control-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-bar {
                max-width: 100%;
            }

            .filter-bar {
                justify-content: space-between;
            }
        }

        /* Style pour les onglets d'images */
.tabs {
    display: flex;
    background-color: var(--light);
    border-radius: 5px;
    overflow: hidden;
}

.tab {
    padding: 10px 15px;
    cursor: pointer;
    transition: var(--transition);
    text-align: center;
    flex-grow: 1;
}

.tab.active {
    background-color: var(--primary-color);
    color: white;
}

.tab-content {
    padding: 15px 0;
}
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <div class="sidebar-logo-text">AutoSénégal</div>
        </div>
        <ul class="sidebar-menu">
            <li class="sidebar-menu-item">
                <a href="#dashboard" class="sidebar-menu-link active" data-section="dashboard-section">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Tableau de bord</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#vehicles" class="sidebar-menu-link" data-section="vehicles-section">
                    <i class="fas fa-car"></i>
                    <span>Véhicules</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#reservations" class="sidebar-menu-link" data-section="reservations-section">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Réservations</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#clients" class="sidebar-menu-link" data-section="clients-section">
                    <i class="fas fa-users"></i>
                    <span>Clients</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#statistics" class="sidebar-menu-link" data-section="statistics-section">
                    <i class="fas fa-chart-bar"></i>
                    <span>Statistiques</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#settings" class="sidebar-menu-link" data-section="settings-section">
                    <i class="fas fa-cog"></i>
                    <span>Paramètres</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="index.html" class="sidebar-menu-link">
                    <i class="fas fa-globe"></i>
                    <span>Voir le site</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#logout" class="sidebar-menu-link" id="logout-link">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Déconnexion</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title" id="page-title">Tableau de bord</h1>
            <div class="user-dropdown" id="user-menu">
                <div class="user-info">
                    <div class="user-name">Amadou Diop</div>
                    <div class="user-role">Administrateur</div>
                </div>
                <div class="user-avatar">AD</div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="content-section active">
            <!-- Stats Cards -->
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-icon icon-blue">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="stat-info">
                        <h3>48</h3>
                        <p>Véhicules en vente</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon-green">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="stat-info">
                        <h3>12</h3>
                        <p>Véhicules en location</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon-yellow">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3>158</h3>
                        <p>Clients actifs</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon-red">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3>1 254</h3>
                        <p>Visites ce mois</p>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Activité récente</h2>
                </div>
                <div class="section-content">
                    <ul class="activity-list">
                        <li class="activity-item">
                            <div class="activity-icon"><i class="fas fa-car"></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Nouveau véhicule ajouté</div>
                                <div class="activity-desc">Toyota Corolla 2023 a été ajouté à l'inventaire</div>
                                <div class="activity-time">Il y a 2 heures</div>
                            </div>
                        </li>
                        <li class="activity-item">
                            <div class="activity-icon"><i class="fas fa-user"></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Nouvelle demande client</div>
                                <div class="activity-desc">Fatou Ndiaye a envoyé une demande pour Hyundai Tucson</div>
                                <div class="activity-time">Il y a 5 heures</div>
                            </div>
                        </li>
                        <li class="activity-item">
                            <div class="activity-icon"><i class="fas fa-key"></i></div>
                            <div class="activity-content">
                                <div class="activity-title">Nouvelle réservation</div>
                                <div class="activity-desc">Réservation confirmée pour Nissan Qashqai</div>
                                <div class="activity-time">Hier</div>
                            </div>
                        </li>
                    </ul>
                </div>
            </section>
        </div>

        <!-- Vehicles Section -->
        <div id="vehicles-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Gestion des véhicules</h2>
                    <button class="add-btn" id="openAddVehicleModal">
                        <i class="fas fa-plus"></i>
                        Ajouter un véhicule
                    </button>
                </div>
                <div class="section-content">
                    <div class="control-bar">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Rechercher un véhicule..." id="vehicle-search">
                        </div>
                        <div class="filter-bar">
                            <div class="filter-dropdown">
                                <button class="filter-btn" id="type-filter">
                                    Type <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu" id="type-dropdown">
                                    <a href="#all" class="dropdown-item active">Tous</a>
                                    <a href="#vente" class="dropdown-item">Vente</a>
                                    <a href="#location" class="dropdown-item">Location</a>
                                </div>
                            </div>
                            <div class="filter-dropdown">
                                <button class="filter-btn" id="status-filter">
                                    Statut <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu" id="status-dropdown">
                                    <a href="#all" class="dropdown-item active">Tous</a>
                                    <a href="#disponible" class="dropdown-item">Disponible</a>
                                    <a href="#reserve" class="dropdown-item">Réservé</a>
                                    <a href="#vendu" class="dropdown-item">Vendu</a>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <!-- Ce conteneur sera rempli dynamiquement -->
                    <div class="vehicles-grid">
                        <!-- Le contenu sera généré par JavaScript -->
                    </div>
                </div>
            </section>
        </div></div>

        <!-- Reservations Section -->
        <div id="reservations-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Gestion des réservations</h2>
                    <button class="add-btn" id="openAddReservationModal">
                        <i class="fas fa-plus"></i>
                        Nouvelle réservation
                    </button>
                </div>
                <div class="section-content">
                    <!-- Reservation tabs -->
                    <div class="reservation-tabs">
                        <button class="tab-btn active" data-tab="all">Toutes</button>
                        <button class="tab-btn" data-tab="pending">En attente</button>
                        <button class="tab-btn" data-tab="confirmed">Confirmées</button>
                        <button class="tab-btn" data-tab="active">En cours</button>
                        <button class="tab-btn" data-tab="completed">Terminées</button>
                        <button class="tab-btn" data-tab="cancelled">Annulées</button>
                    </div>

                    <!-- Search and filter -->
                    <div class="control-bar">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Rechercher une réservation..." id="reservation-search">
                        </div>
                        <div class="filter-bar">
                            <div class="date-filter">
                                <input type="date" id="date-from" class="date-input" placeholder="Date début">
                                <span>à</span>
                                <input type="date" id="date-to" class="date-input" placeholder="Date fin">
                                <button class="filter-btn" id="apply-date-filter">Appliquer</button>
                            </div>
                        </div>
                    </div>

                    <!-- Toggle between list and calendar views -->
                    <div class="view-toggle">
                        <button class="view-btn active" id="list-view-btn"><i class="fas fa-list"></i> Liste</button>
                        <button class="view-btn" id="calendar-view-btn"><i class="fas fa-calendar-alt"></i> Calendrier</button>
                    </div>

                    <!-- List view -->
                    <div id="list-view" class="view-content active">
                        <div class="reservations-table-container">
                            <table class="reservations-table">
                                <thead>
                                    <tr>
                                        <th>Référence</th>
                                        <th>Client</th>
                                        <th>Véhicule</th>
                                        <th>Date début</th>
                                        <th>Date fin</th>
                                        <th>Montant</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-status="pending">
                                        <td>#RES-001</td>
                                        <td>Moussa Sow</td>
                                        <td>Nissan Qashqai</td>
                                        <td>15/03/2025</td>
                                        <td>20/03/2025</td>
                                        <td>225 000 FCFA</td>
                                        <td><span class="status-badge pending">En attente</span></td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="action-btn view-reservation" title="Voir détails" data-id="001"><i class="fas fa-eye"></i></button>
                                                <button class="action-btn confirm-reservation" title="Confirmer" data-id="001"><i class="fas fa-check"></i></button>
                                                <button class="action-btn cancel-reservation" title="Annuler" data-id="001"><i class="fas fa-times"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-status="confirmed">
                                        <td>#RES-002</td>
                                        <td>Fatou Diallo</td>
                                        <td>Toyota Corolla</td>
                                        <td>18/03/2025</td>
                                        <td>25/03/2025</td>
                                        <td>245 000 FCFA</td>
                                        <td><span class="status-badge confirmed">Confirmée</span></td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="action-btn view-reservation" title="Voir détails" data-id="002"><i class="fas fa-eye"></i></button>
                                                <button class="action-btn edit-reservation" title="Modifier" data-id="002"><i class="fas fa-edit"></i></button>
                                                <button class="action-btn cancel-reservation" title="Annuler" data-id="002"><i class="fas fa-times"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-status="active">
                                        <td>#RES-003</td>
                                        <td>Ibrahima Fall</td>
                                        <td>Kia Sportage</td>
                                        <td>10/03/2025</td>
                                        <td>17/03/2025</td>
                                        <td>350 000 FCFA</td>
                                        <td><span class="status-badge active">En cours</span></td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="action-btn view-reservation" title="Voir détails" data-id="003"><i class="fas fa-eye"></i></button>
                                                <button class="action-btn complete-reservation" title="Marquer comme terminée" data-id="003"><i class="fas fa-check-circle"></i></button>
                                                <button class="action-btn extend-reservation" title="Prolonger" data-id="003"><i class="fas fa-calendar-plus"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-status="completed">
                                        <td>#RES-004</td>
                                        <td>Aminata Ndiaye</td>
                                        <td>Hyundai Tucson</td>
                                        <td>01/03/2025</td>
                                        <td>08/03/2025</td>
                                        <td>420 000 FCFA</td>
                                        <td><span class="status-badge completed">Terminée</span></td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="action-btn view-reservation" title="Voir détails" data-id="004"><i class="fas fa-eye"></i></button>
                                                <button class="action-btn add-invoice" title="Facture" data-id="004"><i class="fas fa-file-invoice"></i></button>
                                                <button class="action-btn add-review" title="Avis client" data-id="004"><i class="fas fa-star"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-status="cancelled">
                                        <td>#RES-005</td>
                                        <td>Omar Sarr</td>
                                        <td>Toyota Corolla</td>
                                        <td>05/03/2025</td>
                                        <td>12/03/2025</td>
                                        <td>245 000 FCFA</td>
                                        <td><span class="status-badge cancelled">Annulée</span></td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="action-btn view-reservation" title="Voir détails" data-id="005"><i class="fas fa-eye"></i></button>
                                                <button class="action-btn restore-reservation" title="Restaurer" data-id="005"><i class="fas fa-undo"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Calendar view -->
                    <div id="calendar-view" class="view-content">
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <button class="calendar-nav-btn" id="prev-month"><i class="fas fa-chevron-left"></i></button>
                                <h3 id="calendar-title">Mars 2025</h3>
                                <button class="calendar-nav-btn" id="next-month"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-grid">
                                <div class="calendar-weekdays">
                                    <div>Lun</div>
                                    <div>Mar</div>
                                    <div>Mer</div>
                                    <div>Jeu</div>
                                    <div>Ven</div>
                                    <div>Sam</div>
                                    <div>Dim</div>
                                </div>
                                <div class="calendar-days">
                                    <!-- Jours générés par JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="calendar-legend">
                            <div class="legend-item">
                                <div class="legend-color pending"></div>
                                <div>En attente</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color confirmed"></div>
                                <div>Confirmée</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color active"></div>
                                <div>En cours</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color completed"></div>
                                <div>Terminée</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="pagination">
                        <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                        <button class="pagination-btn active">1</button>
                        <button class="pagination-btn">2</button>
                        <button class="pagination-btn">3</button>
                        <button class="pagination-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </section>
            
            <!-- Vehicle Availability Section -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Disponibilité des véhicules</h2>
                </div>
                <div class="section-content">
                    <div class="availability-filters">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Rechercher un véhicule...">
                        </div>
                        <div class="date-range">
                            <div class="date-input-group">
                                <label>Période :</label>
                                <input type="date" id="availability-start" class="date-input">
                                <span>à</span>
                                <input type="date" id="availability-end" class="date-input">
                                <button class="filter-btn">Vérifier</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="availability-grid">
                        <div class="vehicle-availability">
                            <div class="vehicle-info">
                                <img src="/api/placeholder/100/80" alt="Nissan Qashqai" class="vehicle-thumbnail">
                                <div class="vehicle-details">
                                    <h4>Nissan Qashqai</h4>
                                    <p>45 000 FCFA / jour</p>
                                </div>
                            </div>
                            <div class="availability-timeline">
                                <div class="timeline-dates">
                                    <div>15/03</div>
                                    <div>16/03</div>
                                    <div>17/03</div>
                                    <div>18/03</div>
                                    <div>19/03</div>
                                    <div>20/03</div>
                                    <div>21/03</div>
                                </div>
                                <div class="timeline-slots">
                                    <div class="timeline-slot reserved" title="Réservé: Moussa Sow #RES-001"></div>
                                    <div class="timeline-slot reserved" title="Réservé: Moussa Sow #RES-001"></div>
                                    <div class="timeline-slot reserved" title="Réservé: Moussa Sow #RES-001"></div>
                                    <div class="timeline-slot reserved" title="Réservé: Moussa Sow #RES-001"></div>
                                    <div class="timeline-slot reserved" title="Réservé: Moussa Sow #RES-001"></div>
                                    <div class="timeline-slot available" title="Disponible"></div>
                                    <div class="timeline-slot available" title="Disponible"></div>
                                </div>
                            </div>
                            <div class="availability-actions">
                                <button class="btn btn-primary btn-sm">Réserver</button>
                                <button class="btn btn-secondary btn-sm">Bloquer</button>
                            </div>
                        </div>
                        
                        <div class="vehicle-availability">
                            <div class="vehicle-info">
                                <img src="/api/placeholder/100/80" alt="Toyota Corolla" class="vehicle-thumbnail">
                                <div class="vehicle-details">
                                    <h4>Toyota Corolla</h4>
                                    <p>35 000 FCFA / jour</p>
                                </div>
                            </div>
                            <div class="availability-timeline">
                                <div class="timeline-dates">
                                    <div>15/03</div>
                                    <div>16/03</div>
                                    <div>17/03</div>
                                    <div>18/03</div>
                                    <div>19/03</div>
                                    <div>20/03</div>
                                    <div>21/03</div>
                                </div>
                                <div class="timeline-slots">
                                    <div class="timeline-slot available" title="Disponible"></div>
                                    <div class="timeline-slot available" title="Disponible"></div>
                                    <div class="timeline-slot available" title="Disponible"></div>
                                    <div class="timeline-slot reserved" title="Réservé: Fatou Diallo #RES-002"></div>
                                    <div class="timeline-slot reserved" title="Réservé: Fatou Diallo #RES-002"></div>
                                    <div class="timeline-slot reserved" title="Réservé: Fatou Diallo #RES-002"></div>
                                    <div class="timeline-slot reserved" title="Réservé: Fatou Diallo #RES-002"></div>
                                </div>
                            </div>
                            <div class="availability-actions">
                                <button class="btn btn-primary btn-sm">Réserver</button>
                                <button class="btn btn-secondary btn-sm">Bloquer</button>
                            </div>
                        </div>
                        
                        <div class="vehicle-availability">
                            <div class="vehicle-info">
                                <img src="/api/placeholder/100/80" alt="Kia Sportage" class="vehicle-thumbnail">
                                <div class="vehicle-details">
                                    <h4>Kia Sportage</h4>
                                    <p>50 000 FCFA / jour</p>
                                </div>
                            </div>
                            <div class="availability-timeline">
                                <div class="timeline-dates">
                                    <div>15/03</div>
                                    <div>16/03</div>
                                    <div>17/03</div>
                                    <div>18/03</div>
                                    <div>19/03</div>
                                    <div>20/03</div>
                                    <div>21/03</div>
                                </div>
                                <div class="timeline-slots">
                                    <div class="timeline-slot in-use" title="En cours: Ibrahima Fall #RES-003"></div>
                                    <div class="timeline-slot in-use" title="En cours: Ibrahima Fall #RES-003"></div>
                                    <div class="timeline-slot in-use" title="En cours: Ibrahima Fall #RES-003"></div>
                                    <div class="timeline-slot available" title="Disponible"></div>
                                    <div class="timeline-slot available" title="Disponible"></div>
                                    <div class="timeline-slot available" title="Disponible"></div>
                                    <div class="timeline-slot available" title="Disponible"></div>
                                </div>
                            </div>
                            <div class="availability-actions">
                                <button class="btn btn-primary btn-sm">Réserver</button>
                                <button class="btn btn-secondary btn-sm">Bloquer</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <!-- Clients Section -->
        <div id="clients-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Gestion des clients</h2>
                </div>
                <div class="section-content">
                    <p>Contenu de la section clients à venir...</p>
                </div>
            </section>
        </div>
        
        <!-- Stats Section -->
        <div id="statistics-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Statistiques</h2>
                </div>
                <div class="section-content">
                    <p>Contenu des statistiques à venir...</p>
                </div>
            </section>
        </div>
        
        <!-- Settings Section -->
        <div id="settings-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Paramètres</h2>
                </div>
                <div class="section-content">
                    <p>Contenu des paramètres à venir...</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Add Vehicle Modal -->
    <div class="modal" id="addVehicleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Ajouter un nouveau véhicule</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addVehicleForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="vehicleType" class="form-label">Type de service</label>
                            <select id="vehicleType" class="form-select">
                                <option value="sale">Vente</option>
                                <option value="rent">Location</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleMake" class="form-label">Marque</label>
                            <input type="text" id="vehicleMake" class="form-control" placeholder="Ex: Toyota">
                        </div>
                        <div class="form-group">
                            <label for="vehicleModel" class="form-label">Modèle</label>
                            <input type="text" id="vehicleModel" class="form-control" placeholder="Ex: RAV4">
                        </div>
                        <div class="form-group">
                            <label for="vehicleYear" class="form-label">Année</label>
                            <input type="number" id="vehicleYear" class="form-control" placeholder="Ex: 2023">
                        </div>
                        <div class="form-group">
                            <label for="vehiclePrice" class="form-label">Prix</label>
                            <input type="number" id="vehiclePrice" class="form-control" placeholder="En FCFA">
                        </div>
                        <div class="form-group">
                            <label for="vehicleMileage" class="form-label">Kilométrage</label>
                            <input type="number" id="vehicleMileage" class="form-control" placeholder="En km">
                        </div>
                        <div class="form-group">
                            <label for="vehicleFuel" class="form-label">Carburant</label>
                            <select id="vehicleFuel" class="form-select">
                                <option value="essence">Essence</option>
                                <option value="diesel">Diesel</option>
                                <option value="hybrid">Hybride</option>
                                <option value="electric">Électrique</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleTransmission" class="form-label">Transmission</label>
                            <select id="vehicleTransmission" class="form-select">
                                <option value="manual">Manuelle</option>
                                <option value="auto">Automatique</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="vehicleDescription" class="form-label">Description</label>
                        <textarea id="vehicleDescription" class="form-control" rows="4" placeholder="Description détaillée du véhicule..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Photos</label>
                        <div class="tabs" style="margin-bottom: 15px;">
                            <div class="tab active" data-image-tab="upload">Télécharger des photos</div>
                            <div class="tab" data-image-tab="select">Sélectionner des images existantes</div>
                        </div>
                        
                        <!-- Tab content: Upload -->
                        <div class="tab-content active" id="upload-tab-content">
                            <div class="upload-container" style="padding: 15px;">
                                <div class="upload-icon" style="font-size: 2rem; margin-bottom: 10px;">
                                    <i class="fas fa-image"></i>
                                </div>
                                <p style="margin-bottom: 10px; font-size: 0.9rem;">Ajoutez des photos pour montrer votre véhicule</p>
                                <button class="upload-btn" id="vehiclePhotoUploadBtn" type="button" style="font-size: 0.9rem; padding: 8px 15px;">
                                    <i class="fas fa-plus"></i> Ajouter des photos
                                </button>
                                <input type="file" id="vehiclePhotoInput" class="file-input" multiple accept="image/*">
                                <div id="photoCounter" style="margin-top: 10px; font-size: 0.8rem; color: #777;">0 photo sélectionnée</div>
                            </div>
                            
                            <!-- Zone de prévisualisation des photos -->
                            <div id="vehiclePhotoPreview" class="photo-preview-container" style="display: none; flex-wrap: wrap; gap: 10px; margin-top: 15px;"></div>
                        </div>
                        
                        <!-- Tab content: Select -->
                        <div class="tab-content" id="select-tab-content" style="display: none;">
                            <div class="search-bar" style="margin-bottom: 15px;">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Rechercher une image..." id="image-search">
                            </div>
                            
                            <div id="available-images-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; max-height: 300px; overflow-y: auto;">
                                <!-- Les images seront chargées ici dynamiquement -->
                                <div class="loading-indicator" style="grid-column: 1/-1; text-align: center; padding: 20px;">
                                    <i class="fas fa-spinner fa-spin"></i> Chargement des images...
                                </div>
                            </div>
                            
                            <div id="selected-images-container" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                                <h4 style="margin-bottom: 10px; font-size: 1rem;">Images sélectionnées pour ce véhicule</h4>
                                <div id="selected-images" style="display: flex; flex-wrap: wrap; gap: 10px;">
                                    <!-- Les images sélectionnées seront affichées ici -->
                                    <div class="empty-selection" style="width: 100%; text-align: center; padding: 15px; color: #777; font-style: italic;">
                                        Aucune image sélectionnée
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddVehicle">Annuler</button>
                <button class="btn btn-primary" id="saveVehicle">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <style>
        /* Additional styles for new elements */
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .activity-list {
            list-style: none;
            padding: 0;
        }
        
        .activity-item {
            display: flex;
            align-items: flex-start;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(0, 124, 90, 0.1);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .activity-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .activity-desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: #999;
        }
        
        .dropdown-menu {
            position: absolute;
            background-color: white;
            box-shadow: var(--shadow);
            border-radius: 5px;
            min-width: 150px;
            z-index: 10;
            display: none;
            margin-top: 5px;
        }
        
        .dropdown-menu.active {
            display: block;
        }
        
        .dropdown-item {
            display: block;
            padding: 8px 15px;
            text-decoration: none;
            color: var(--dark);
            transition: var(--transition);
        }
        
        .dropdown-item:hover,
        .dropdown-item.active {
            background-color: rgba(0, 124, 90, 0.1);
            color: var(--primary-color);
        }
        
        .reservations-table-container {
            overflow-x: auto;
        }
        
        .reservations-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .reservations-table th,
        .reservations-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .reservations-table th {
            background-color: var(--light);
            font-weight: 600;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-badge.pending {
            background-color: rgba(255, 206, 0, 0.1);
            color: #f9a825;
        }
        
        .status-badge.confirmed {
            background-color: rgba(0, 124, 90, 0.1);
            color: var(--primary-color);
        }
        
        .status-badge.active {
            background-color: rgba(33, 150, 243, 0.1);
            color: #2196f3;
        }
        
        .status-badge.completed {
            background-color: rgba(76, 175, 80, 0.1);
            color: #4caf50;
        }
        
        .status-badge.cancelled {
            background-color: rgba(244, 67, 54, 0.1);
            color: #f44336;
        }
        
        .table-actions {
            display: flex;
            gap: 5px;
        }
        
        .edit-modal-content {
            padding: 20px;
        }
        
        /* Modal for image viewing */
        .image-view-modal .modal-content {
            max-width: 90%;
            height: auto;
        }
        
        .image-view-container {
            display: flex;
            justify-content: center;
            max-height: 80vh;
            overflow: hidden;
        }
        
        .image-view-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        /* Reservation section styles */
        .reservation-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 8px 16px;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .date-filter {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .date-input {
            padding: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .view-btn {
            padding: 8px 16px;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .view-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .view-content {
            display: none;
        }
        
        .view-content.active {
            display: block;
        }
        
        /* Calendar view */
        .calendar-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: white;
        }
        
        .calendar-nav-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            padding: 5px 10px;
        }
        
        .calendar-grid {
            padding: 20px;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-gap: 5px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            padding: 5px;
            text-align: center;
            cursor: pointer;
            position: relative;
        }
        
        .calendar-day.other-month {
            opacity: 0.3;
        }
        
        .calendar-day.today {
            border-color: var(--primary-color);
            font-weight: 600;
        }
        
        .calendar-day.has-events::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background-color: var(--primary-color);
        }
        
        .calendar-legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }
        
        .legend-color.pending {
            background-color: #f9a825;
        }
        
        .legend-color.confirmed {
            background-color: var(--primary-color);
        }
        
        .legend-color.active {
            background-color: #2196f3;
        }
        
        .legend-color.completed {
            background-color: #4caf50;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 20px;
        }
        
        .pagination-btn {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            background-color: white;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .pagination-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Availability timeline */
        .availability-filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .date-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .availability-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .vehicle-availability {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 15px;
            gap: 20px;
        }
        
        .vehicle-info {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 200px;
            flex-shrink: 0;
        }
        
        .vehicle-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
        }
        
        .vehicle-details h4 {
            margin: 0 0 5px;
            font-size: 1rem;
        }
        
        .vehicle-details p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--primary-color);
        }
        
        .availability-timeline {
            flex-grow: 1;
            overflow-x: auto;
        }
        
        .timeline-dates {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.8rem;
            color: #777;
        }
        
        .timeline-dates div {
            width: calc(100% / 7);
            text-align: center;
        }
        
        .timeline-slots {
            display: flex;
            height: 30px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .timeline-slot {
            width: calc(100% / 7);
            height: 100%;
        }
        
        .timeline-slot.available {
            background-color: rgba(76, 175, 80, 0.2);
        }
        
        .timeline-slot.reserved {
            background-color: rgba(255, 206, 0, 0.5);
        }
        
        .timeline-slot.in-use {
            background-color: rgba(33, 150, 243, 0.5);
        }
        
        .timeline-slot.blocked {
            background-color: rgba(244, 67, 54, 0.2);
        }
        
        .availability-actions {
            display: flex;
            gap: 10px;
            width: 180px;
            flex-shrink: 0;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            .vehicle-availability {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .vehicle-info {
                width: 100%;
            }
            
            .availability-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>


<script>
    
    // Variables globales
    let photoCount = 0;
    const vehiclePhotoInput = document.getElementById('vehiclePhotoInput');
    const vehiclePhotoPreview = document.getElementById('vehiclePhotoPreview');
    const vehiclePhotoUploadBtn = document.getElementById('vehiclePhotoUploadBtn');
    let currentMonth = new Date();
    
    // ----------------- NAVIGATION ET INTERFACE GÉNÉRALE -----------------
    
    // Navigation entre les sections
    function showActiveSection() {
        console.log("Mise à jour de la section active");
        // Get hash from URL or use default
        const hash = window.location.hash || '#dashboard';
        
        // Remove active class from all links and sections
        const sidebarLinks = document.querySelectorAll('.sidebar-menu-link');
        const contentSections = document.querySelectorAll('.content-section');
        
        sidebarLinks.forEach(link => link.classList.remove('active'));
        contentSections.forEach(section => section.classList.remove('active'));
        
        // Add active class to current link and section
        const currentLink = document.querySelector(`a[href="${hash}"]`);
        if (currentLink) {
            currentLink.classList.add('active');
            
            // Update page title
            const pageTitle = document.getElementById('page-title');
            if (pageTitle) {
                const sectionName = currentLink.querySelector('span').textContent;
                pageTitle.textContent = sectionName;
            }
            
            // Show current section
            const sectionId = currentLink.getAttribute('data-section');
            if (sectionId) {
                const currentSection = document.getElementById(sectionId);
                if (currentSection) {
                    currentSection.classList.add('active');
                    console.log("Section activée:", sectionId);
                }
            }
        } else if (hash === '#logout') {
            handleLogout();
        }
    }
    
    // Gestion de la déconnexion
    function handleLogout() {
        console.log("Tentative de déconnexion");
        if (confirm('Êtes-vous sûr de vouloir vous déconnecter?')) {
            console.log("Déconnexion confirmée");
            window.location.href = 'index.html';
        } else {
            console.log("Déconnexion annulée");
            window.location.hash = '#dashboard';
        }
    }
    
    // ----------------- GESTION DES PHOTOS ET UPLOADS -----------------
    
    // Fonction générique pour gérer l'upload de fichiers
    function handleFiles(files) {
        console.log(`${files.length} fichier(s) sélectionné(s)`);
        // Dans une application réelle, vous enverriez ces fichiers au serveur
        alert(`${files.length} fichier(s) sélectionné(s) avec succès!`);
    }
    
    // Fonction pour afficher les prévisualisations de photos dans le formulaire de véhicule
    function displayPhotoPreviews(files) {
        if (!vehiclePhotoPreview) {
            console.error("Conteneur de prévisualisation introuvable");
            return;
        }
        
        console.log("Prévisualisation des photos...", files.length, "fichiers sélectionnés");
        
        // S'assurer que la zone de prévisualisation est visible
        vehiclePhotoPreview.style.display = 'flex';
        
        // Créer les aperçus pour chaque fichier
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            
            // Vérifier si c'est une image
            if (!file.type.startsWith('image/')) {
                console.log("Fichier ignoré - pas une image:", file.name);
                continue;
            }
            
            // Limiter le nombre de photos (facultatif)
            if (photoCount >= 10) {
                alert('Vous ne pouvez pas ajouter plus de 10 photos.');
                break;
            }
            
            console.log("Traitement de l'image:", file.name);
            
            // Créer l'élément du conteneur de prévisualisation
            const previewContainer = document.createElement('div');
            previewContainer.className = 'photo-preview-item';
            previewContainer.dataset.photoId = `new-${Date.now()}-${i}`;
            previewContainer.style.width = '100px';
            previewContainer.style.height = '100px';
            previewContainer.style.position = 'relative';
            previewContainer.style.borderRadius = '8px';
            previewContainer.style.overflow = 'hidden';
            previewContainer.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
            previewContainer.style.margin = '5px';
            
            // Créer l'élément d'image
            const img = document.createElement('img');
            img.className = 'preview-thumbnail';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            
            // Créer le lecteur de fichier pour charger l'image
            const reader = new FileReader();
            reader.onload = function(e) {
                console.log("Image chargée avec succès:", file.name);
                img.src = e.target.result;
            };
            
            reader.onerror = function(e) {
                console.error("Erreur de chargement de l'image:", e);
            };
            
            reader.readAsDataURL(file);
            
            // Créer le bouton de suppression
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-photo-btn';
            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
            removeBtn.style.position = 'absolute';
            removeBtn.style.top = '5px';
            removeBtn.style.right = '5px';
            removeBtn.style.width = '20px';
            removeBtn.style.height = '20px';
            removeBtn.style.borderRadius = '50%';
            removeBtn.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';
            removeBtn.style.color = 'white';
            removeBtn.style.border = 'none';
            removeBtn.style.display = 'flex';
            removeBtn.style.alignItems = 'center';
            removeBtn.style.justifyContent = 'center';
            removeBtn.style.cursor = 'pointer';
            removeBtn.style.fontSize = '10px';
            
            // Ajouter un événement de clic directement sur le bouton
            removeBtn.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log("Suppression de la photo:", file.name);
                previewContainer.remove();
                photoCount--;
                
                // Mettre à jour l'état du compteur
                updatePhotoCounter();
                
                // Cacher la zone de prévisualisation si elle est vide
                if (photoCount === 0) {
                    vehiclePhotoPreview.style.display = 'none';
                }
            };
            
            // Assembler les éléments
            previewContainer.appendChild(img);
            previewContainer.appendChild(removeBtn);
            
            // Ajouter à la prévisualisation
            vehiclePhotoPreview.appendChild(previewContainer);
            photoCount++;
            
            // Mettre à jour le compteur de photos
            updatePhotoCounter();
        }
    }
    
    // Mettre à jour le compteur de photos
    function updatePhotoCounter() {
        const photoCounter = document.getElementById('photoCounter');
        if (photoCounter) {
            photoCounter.textContent = `${photoCount} photo${photoCount !== 1 ? 's' : ''} sélectionnée${photoCount !== 1 ? 's' : ''}`;
            console.log("Compteur de photos mis à jour:", photoCount);
        }
    }
    
    // ----------------- GESTION DES VÉHICULES -----------------
    
    // Gestionnaire pour la suppression des véhicules
    function deleteVehicleHandler(event) {
        event.preventDefault();
        event.stopPropagation();
        
        const vehicleId = this.getAttribute('data-vehicle-id');
        console.log("Tentative de suppression du véhicule ID:", vehicleId);
        
        if (confirm(`Êtes-vous sûr de vouloir supprimer le véhicule ID: ${vehicleId}?`)) {
            console.log("Suppression confirmée pour le véhicule ID:", vehicleId);
            
            // Trouver et supprimer la carte du véhicule du DOM
            const vehicleCard = document.querySelector(`.vehicle-card[data-vehicle-id="${vehicleId}"]`);
            if (vehicleCard) {
                vehicleCard.remove();
                console.log("Véhicule supprimé avec succès du DOM");
                alert(`Véhicule ID: ${vehicleId} supprimé avec succès`);
            } else {
                console.error("Élément véhicule non trouvé dans le DOM");
            }
        } else {
            console.log("Suppression annulée par l'utilisateur");
        }
    }
    
    // Gestionnaire pour l'édition des véhicules
    // Fonction pour éditer un véhicule
function editVehicle(vehicleId) {
    const vehicle = DataService.getVehicleById(vehicleId);
    if (!vehicle) return;
    
    // Ouvrir le modal d'édition
    const modal = document.getElementById('addVehicleModal');
    if (!modal) return;
    
    // Mettre à jour le titre du modal
    const modalTitle = modal.querySelector('.modal-title');
    if (modalTitle) modalTitle.textContent = 'Modifier un véhicule';
    
    // Remplir le formulaire avec les données du véhicule
    document.getElementById('vehicleType').value = vehicle.type || 'sale';
    document.getElementById('vehicleMake').value = vehicle.make || '';
    document.getElementById('vehicleModel').value = vehicle.model || '';
    document.getElementById('vehicleYear').value = vehicle.year || '';
    document.getElementById('vehiclePrice').value = vehicle.price || '';
    document.getElementById('vehicleMileage').value = vehicle.mileage || '';
    document.getElementById('vehicleFuel').value = vehicle.fuel || 'essence';
    document.getElementById('vehicleTransmission').value = vehicle.transmission || 'manual';
    document.getElementById('vehicleDescription').value = vehicle.description || '';
    
    // Ajouter l'ID du véhicule comme attribut data au formulaire
    const form = document.getElementById('addVehicleForm');
    if (form) {
        form.dataset.vehicleId = vehicleId;
        
        // Stocker également les images actuelles
        if (vehicle.images && Array.isArray(vehicle.images)) {
            form.setAttribute('data-selected-images', JSON.stringify(vehicle.images));
            console.log("Images préchargées:", vehicle.images);
        } else {
            form.setAttribute('data-selected-images', '[]');
        }
    }
    
    // Afficher le modal
    modal.classList.add('active');
    
    // Configurer le bouton de sauvegarde
    const saveButton = document.getElementById('saveVehicle');
    if (saveButton) {
        // Remplacer l'ancien écouteur d'événements
        const newSaveButton = saveButton.cloneNode(true);
        saveButton.parentNode.replaceChild(newSaveButton, saveButton);
        
        newSaveButton.addEventListener('click', function() {
            saveVehicleChanges(vehicleId);
        });
    }
    
    // Si l'onglet "Sélectionner des images existantes" est disponible
    const selectImagesTab = document.querySelector('[data-image-tab="select"]');
    if (selectImagesTab) {
        // Simuler un clic sur cet onglet pour charger les images
        setTimeout(() => {
            selectImagesTab.click();
        }, 100);
    }
}
    
    // ----------------- GESTION DES IMAGES -----------------
    
    // Gestionnaire pour la suppression des images
    function deleteImageHandler(event) {
        event.preventDefault();
        event.stopPropagation();
        
        const imageId = this.getAttribute('data-image-id');
        console.log("Tentative de suppression de l'image ID:", imageId);
        
        if (confirm(`Êtes-vous sûr de vouloir supprimer l'image ID: ${imageId}?`)) {
            console.log("Suppression confirmée pour l'image ID:", imageId);
            
            // Trouver et supprimer l'image du DOM
            const imageElement = document.querySelector(`.uploaded-image[data-image-id="${imageId}"]`);
            if (imageElement) {
                imageElement.remove();
                console.log("Image supprimée avec succès du DOM");
                alert(`Image ID: ${imageId} supprimée avec succès`);
            } else {
                console.error("Élément image non trouvé dans le DOM");
            }
        } else {
            console.log("Suppression annulée par l'utilisateur");
        }
    }
    
    // Gestionnaire pour la visualisation des images
    function viewImageHandler(event) {
        event.preventDefault();
        event.stopPropagation();
        
        const imageId = this.getAttribute('data-image-id');
        console.log("Visualisation de l'image ID:", imageId);
        
        // Dans une application réelle, vous afficheriez l'image en plein écran
        // ou dans un modal
        alert(`Visualisation de l'image ID: ${imageId}`);
    }
    
    // Gestionnaire pour l'édition des images
    function editImageHandler(event) {
        event.preventDefault();
        event.stopPropagation();
        
        const imageId = this.getAttribute('data-image-id');
        console.log("Édition de l'image ID:", imageId);
        
        // Dans une application réelle, vous ouvririez un modal pour éditer
        // les métadonnées de l'image
        alert(`Édition de l'image ID: ${imageId}`);
    }
    
    // ----------------- GESTION DES RÉSERVATIONS -----------------
    
    // Fonction pour filtrer les réservations par statut
    function filterReservationsByStatus(status) {
        console.log("Filtrage des réservations par statut:", status);
        
        const reservationRows = document.querySelectorAll('.reservations-table tbody tr');
        
        reservationRows.forEach(row => {
            if (status === 'all' || row.getAttribute('data-status') === status) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }
    
    // Gestionnaire pour les actions sur les réservations
    function reservationActionHandler(event, action) {
        event.preventDefault();
        event.stopPropagation();
        
        const reservationId = this.getAttribute('data-id');
        console.log(`Action ${action} sur la réservation ID:`, reservationId);
        
        switch (action) {
            case 'view':
                alert(`Afficher détails de la réservation #RES-${reservationId}`);
                break;
            case 'confirm':
                if (confirm(`Confirmer la réservation #RES-${reservationId}?`)) {
                    alert(`Réservation #RES-${reservationId} confirmée`);
                }
                break;
            case 'cancel':
                if (confirm(`Êtes-vous sûr de vouloir annuler la réservation #RES-${reservationId}?`)) {
                    alert(`Réservation #RES-${reservationId} annulée`);
                }
                break;
            case 'edit':
                alert(`Modifier la réservation #RES-${reservationId}`);
                break;
            case 'complete':
                if (confirm(`Marquer la réservation #RES-${reservationId} comme terminée?`)) {
                    alert(`Réservation #RES-${reservationId} terminée`);
                }
                break;
            case 'extend':
                alert(`Prolonger la réservation #RES-${reservationId}`);
                break;
        }
    }
    
    // ----------------- CALENDRIER -----------------
    
    // Générer le calendrier pour un mois donné
    function generateCalendar(date) {
        console.log("Génération du calendrier pour:", date);
        
        const calendarDays = document.querySelector('.calendar-days');
        const calendarTitle = document.getElementById('calendar-title');
        
        if (!calendarDays || !calendarTitle) {
            console.error("Éléments du calendrier introuvables");
            return;
        }
        
        // Effacer les jours existants
        calendarDays.innerHTML = '';
        
        // Définir le titre du calendrier
        const months = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
        calendarTitle.textContent = `${months[date.getMonth()]} ${date.getFullYear()}`;
        
        // Obtenir le premier jour du mois
        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
        // Obtenir le dernier jour du mois
        const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
        
        // Obtenir le jour de la semaine pour le premier jour (0 = Dimanche, 1 = Lundi, etc.)
        // Conversion en base lundi (0 = Lundi, 6 = Dimanche)
        let firstDayOfWeek = firstDay.getDay() - 1;
        if (firstDayOfWeek < 0) firstDayOfWeek = 6;
        
        // Obtenir la date actuelle
        const currentDate = new Date();
        
        // Ajouter les jours du mois précédent
        for (let i = 0; i < firstDayOfWeek; i++) {
            const prevDate = new Date(date.getFullYear(), date.getMonth(), -i);
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('calendar-day', 'other-month');
            dayDiv.textContent = prevDate.getDate();
            calendarDays.prepend(dayDiv);
        }
        
        // Ajouter les jours du mois courant
        for (let i = 1; i <= lastDay.getDate(); i++) {
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('calendar-day');
            dayDiv.textContent = i;
            
            // Vérifier si c'est aujourd'hui
            if (currentDate.getDate() === i && 
                currentDate.getMonth() === date.getMonth() && 
                currentDate.getFullYear() === date.getFullYear()) {
                dayDiv.classList.add('today');
            }
            
            // Ajouter des indicateurs d'événements pour certains jours (à titre d'exemple)
            if ([3, 5, 10, 15, 18, 20, 25].includes(i)) {
                dayDiv.classList.add('has-events');
            }
            
            // Ajouter un événement de clic pour afficher les réservations de ce jour
            dayDiv.addEventListener('click', function() {
                alert(`Afficher les réservations pour le ${i} ${months[date.getMonth()]} ${date.getFullYear()}`);
            });
            
            calendarDays.appendChild(dayDiv);
        }
        
        // Ajouter les jours du mois suivant pour compléter la grille
        const totalDaysAdded = firstDayOfWeek + lastDay.getDate();
        const daysToAdd = 42 - totalDaysAdded; // 6 semaines * 7 jours = 42
        
        for (let i = 1; i <= daysToAdd; i++) {
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('calendar-day', 'other-month');
            dayDiv.textContent = i;
            calendarDays.appendChild(dayDiv);
        }
    }
    
    // ----------------- MODALS -----------------
    
    // Fonction pour ouvrir un modal
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('active');
            console.log("Modal ouvert:", modalId);
        } else {
            console.error("Modal introuvable:", modalId);
        }
    }
    
    // Fonction pour fermer un modal
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
            console.log("Modal fermé:", modalId);
        } else {
            console.error("Modal introuvable:", modalId);
        }
    }
    
    // ----------------- CONFIGURATION DES ÉVÉNEMENTS -----------------
    
    // Configurer les boutons de suppression de véhicules
    function setupDeleteVehicleButtons() {
        console.log("Configuration des boutons de suppression de véhicules");
        
        const deleteVehicleButtons = document.querySelectorAll('.delete-vehicle');
        deleteVehicleButtons.forEach(button => {
            button.removeEventListener('click', deleteVehicleHandler);
            button.addEventListener('click', deleteVehicleHandler);
        });
    }
    
    // Configurer les boutons d'édition de véhicules
    function setupEditVehicleButtons() {
        console.log("Configuration des boutons d'édition de véhicules");
        
        const editVehicleButtons = document.querySelectorAll('.edit-vehicle');
        editVehicleButtons.forEach(button => {
            button.removeEventListener('click', editVehicleHandler);
            button.addEventListener('click', editVehicleHandler);
        });
    }
    
    // Configurer les boutons pour les images
    function setupImageButtons() {
        console.log("Configuration des boutons d'action pour les images");
        
        // Boutons de suppression d'images
        const deleteImageButtons = document.querySelectorAll('.delete-image');
        deleteImageButtons.forEach(button => {
            button.removeEventListener('click', deleteImageHandler);
            button.addEventListener('click', deleteImageHandler);
        });
        
        // Boutons de visualisation d'images
        const viewImageButtons = document.querySelectorAll('.view-image');
        viewImageButtons.forEach(button => {
            button.removeEventListener('click', viewImageHandler);
            button.addEventListener('click', viewImageHandler);
        });
        
        // Boutons d'édition d'images
        const editImageButtons = document.querySelectorAll('.edit-image');
        editImageButtons.forEach(button => {
            button.removeEventListener('click', editImageHandler);
            button.addEventListener('click', editImageHandler);
        });
    }
    
    // Configurer les boutons pour les réservations
    function setupReservationButtons() {
        console.log("Configuration des boutons pour les réservations");
        
        // Configuration des onglets de statut
        const reservationTabs = document.querySelectorAll('.tab-btn');
        reservationTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Supprimer la classe active de tous les onglets
                reservationTabs.forEach(t => t.classList.remove('active'));
                // Ajouter la classe active à l'onglet cliqué
                this.classList.add('active');
                
                const status = this.getAttribute('data-tab');
                filterReservationsByStatus(status);
            });
        });
        
        // Configuration des boutons d'action sur les réservations
        const setupReservationActionButtons = (selector, action) => {
            const buttons = document.querySelectorAll(selector);
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    reservationActionHandler.call(this, e, action);
                });
            });
        };
        
        setupReservationActionButtons('.view-reservation', 'view');
        setupReservationActionButtons('.confirm-reservation', 'confirm');
        setupReservationActionButtons('.cancel-reservation', 'cancel');
        setupReservationActionButtons('.edit-reservation', 'edit');
        setupReservationActionButtons('.complete-reservation', 'complete');
        setupReservationActionButtons('.extend-reservation', 'extend');
    }
    
    // Configurer les vues du calendrier
    function setupCalendarView() {
        console.log("Configuration de la vue calendrier");
        
        const listViewBtn = document.getElementById('list-view-btn');
        const calendarViewBtn = document.getElementById('calendar-view-btn');
        const listView = document.getElementById('list-view');
        const calendarView = document.getElementById('calendar-view');
        
        if (listViewBtn && calendarViewBtn && listView && calendarView) {
            listViewBtn.addEventListener('click', function() {
                listViewBtn.classList.add('active');
                calendarViewBtn.classList.remove('active');
                listView.classList.add('active');
                calendarView.classList.remove('active');
            });
            
            calendarViewBtn.addEventListener('click', function() {
                calendarViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
                calendarView.classList.add('active');
                listView.classList.remove('active');
                
                // Générer le calendrier s'il est vide
                const calendarDays = document.querySelector('.calendar-days');
                if (calendarDays && calendarDays.children.length === 0) {
                    generateCalendar(new Date());
                }
            });
            
            // Configurer les boutons de navigation du calendrier
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            
            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', function() {
                    currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1);
                    generateCalendar(currentMonth);
                });
            }
            
            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', function() {
                    currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1);
                    generateCalendar(currentMonth);
                });
            }
        }
    }
    
    // Configurer les gestionnaires pour l'upload de fichiers
    function setupFileUploads() {
        console.log("Configuration des zones d'upload de fichiers");
        
        // Zones d'upload générales
        const uploadArea = document.getElementById('uploadArea');
        const browseFiles = document.getElementById('browseFiles');
        const fileInput = document.getElementById('fileInput');
    
        if (browseFiles && fileInput) {
            browseFiles.addEventListener('click', () => {
                fileInput.click();
            });
        }
    
        if (uploadArea && fileInput) {
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#007C5A';
                uploadArea.style.backgroundColor = 'rgba(0, 124, 90, 0.05)';
            });
    
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = 'rgba(0, 0, 0, 0.1)';
                uploadArea.style.backgroundColor = '#F5F5F5';
            });
    
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'rgba(0, 0, 0, 0.1)';
                uploadArea.style.backgroundColor = '#F5F5F5';
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFiles(e.dataTransfer.files);
                }
            });
    
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length) {
                    handleFiles(fileInput.files);
                }
            });
        }
        
        // Upload de photos pour le formulaire de véhicule
        const vehicleUploadArea = document.querySelector('#addVehicleForm .upload-container');
        
        if (vehiclePhotoUploadBtn && vehiclePhotoInput) {
            vehiclePhotoUploadBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log("Clic sur le bouton d'ajout de photos");
                vehiclePhotoInput.click();
            });
            
            vehiclePhotoInput.addEventListener('change', function() {
                console.log("Changement dans l'input de photo:", this.files.length, "fichiers");
                if (this.files.length > 0) {
                    displayPhotoPreviews(this.files);
                }
            });
        }
        
        if (vehicleUploadArea && vehiclePhotoInput) {
            vehicleUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                vehicleUploadArea.style.borderColor = '#007C5A';
                vehicleUploadArea.style.backgroundColor = 'rgba(0, 124, 90, 0.05)';
            });
    
            vehicleUploadArea.addEventListener('dragleave', () => {
                vehicleUploadArea.style.borderColor = 'rgba(0, 0, 0, 0.1)';
                vehicleUploadArea.style.backgroundColor = '#F5F5F5';
            });
    
            vehicleUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                vehicleUploadArea.style.borderColor = 'rgba(0, 0, 0, 0.1)';
                vehicleUploadArea.style.backgroundColor = '#F5F5F5';
                
                if (e.dataTransfer.files.length) {
                    console.log("Fichiers déposés:", e.dataTransfer.files.length);
                    displayPhotoPreviews(e.dataTransfer.files);
                }
            });
        }
    }
    
    // Configurer les modals
    function setupModals() {
        console.log("Configuration des modals");
        
        const addVehicleModal = document.getElementById('addVehicleModal');
        const openAddVehicleModal = document.getElementById('openAddVehicleModal');
        const closeModal = document.getElementById('closeModal');
        const cancelAddVehicle = document.getElementById('cancelAddVehicle');
        const saveVehicle = document.getElementById('saveVehicle');
    
        if (openAddVehicleModal && addVehicleModal) {
            openAddVehicleModal.addEventListener('click', () => {
                addVehicleModal.classList.add('active');
            });
        }
    
        if (closeModal && addVehicleModal) {
            closeModal.addEventListener('click', () => {
                addVehicleModal.classList.remove('active');
            });
        }
    
        if (cancelAddVehicle && addVehicleModal) {
            cancelAddVehicle.addEventListener('click', () => {
                addVehicleModal.classList.remove('active');
            });
        }
    
        if (saveVehicle && addVehicleModal) {
            saveVehicle.addEventListener('click', () => {
                // Dans une application réelle, vous enregistreriez les données du formulaire
                alert('Véhicule ajouté avec succès!');
                addVehicleModal.classList.remove('active');
            });
        }
    
        // Fermer le modal en cliquant à l'extérieur
        window.addEventListener('click', (e) => {
            if (addVehicleModal && e.target === addVehicleModal) {
                addVehicleModal.classList.remove('active');
            }
        });
    }
    
    // Configurer les dropdowns
    function setupDropdowns() {
        console.log("Configuration des dropdowns");
        
        const typeFilter = document.getElementById('type-filter');
        const statusFilter = document.getElementById('status-filter');
        const typeDropdown = document.getElementById('type-dropdown');
        const statusDropdown = document.getElementById('status-dropdown');
        
        // Afficher/cacher les dropdowns au clic
        if (typeFilter && typeDropdown) {
            typeFilter.addEventListener('click', (e) => {
                e.stopPropagation();
                typeDropdown.classList.toggle('active');
                if (statusDropdown) statusDropdown.classList.remove('active');
            });
        }
        
        if (statusFilter && statusDropdown) {
            statusFilter.addEventListener('click', (e) => {
                e.stopPropagation();
                statusDropdown.classList.toggle('active');
                if (typeDropdown) typeDropdown.classList.remove('active');
            });
        }
        
        // Fermer les dropdowns en cliquant ailleurs
        document.addEventListener('click', (e) => {
            if (typeFilter && typeDropdown && !typeFilter.contains(e.target)) {
                typeDropdown.classList.remove('active');
            }
            
            if (statusFilter && statusDropdown && !statusFilter.contains(e.target)) {
                statusDropdown.classList.remove('active');
            }
        });
    }
    
    // Initialisation générale de l'application
    function initializeApp() {
        console.log("Initialisation de l'application");
        
        // Configurer la navigation
        const sidebarLinks = document.querySelectorAll('.sidebar-menu-link');
        sidebarLinks.forEach(link => {
            if (link.getAttribute('href') === '#logout') {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleLogout();
                });
            }
        });
        
        // Montrer la section active basée sur le hash de l'URL
        showActiveSection();
        
        // Configurer toutes les fonctionnalités
        setupDeleteVehicleButtons();
        setupEditVehicleButtons();
        setupImageButtons();
        setupReservationButtons();
        setupCalendarView();
        setupFileUploads();
        setupModals();
        setupDropdowns();
        
        // Initialiser l'état du conteneur de prévisualisation
        if (vehiclePhotoPreview) {
            if (photoCount === 0) {
                vehiclePhotoPreview.style.display = 'none';
            }
        }
        
        // Écouter les changements de hash
        window.addEventListener('hashchange', showActiveSection);
        
        console.log("Application initialisée avec succès");
    }
    
    // Initialiser l'application quand le DOM est chargé
    document.addEventListener('DOMContentLoaded', initializeApp);
  
  // ==============================================
// SERVICE DE DONNÉES PARTAGÉES
// ==============================================
// Ce script doit être inclus dans toutes les pages (index.html, admin-panel.html, image-management.html)

// Clés de stockage localStorage
const STORAGE_KEYS = {
    IMAGES: 'autosenegal_images',
    VEHICLES: 'autosenegal_vehicles',
    CATEGORIES: 'autosenegal_categories',
    SETTINGS: 'autosenegal_settings'
};

// Service de gestion des données
const DataService = {
    // Initialiser les données si elles n'existent pas
    init: function() {
        // Images
        if (!localStorage.getItem(STORAGE_KEYS.IMAGES)) {
            localStorage.setItem(STORAGE_KEYS.IMAGES, JSON.stringify([]));
        }
        
        // Véhicules
        if (!localStorage.getItem(STORAGE_KEYS.VEHICLES)) {
            localStorage.setItem(STORAGE_KEYS.VEHICLES, JSON.stringify([]));
        }
        
        // Catégories d'images
        if (!localStorage.getItem(STORAGE_KEYS.CATEGORIES)) {
            const defaultCategories = [
                { id: 'vehicles', name: 'Véhicules', icon: 'fas fa-car', count: 0 },
                { id: 'interiors', name: 'Intérieurs', icon: 'fas fa-couch', count: 0 },
                { id: 'exteriors', name: 'Extérieurs', icon: 'fas fa-car-side', count: 0 },
                { id: 'others', name: 'Autres', icon: 'fas fa-images', count: 0 }
            ];
            localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(defaultCategories));
        }
        
        // Paramètres
        if (!localStorage.getItem(STORAGE_KEYS.SETTINGS)) {
            localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify({
                siteName: 'AutoSénégal',
                currency: 'FCFA',
                language: 'fr'
            }));
        }
        
        console.log('DataService: Données initialisées');
    },
    
    // =============== GESTION DES IMAGES ===============
    
    // Récupérer toutes les images
    getAllImages: function() {
        return JSON.parse(localStorage.getItem(STORAGE_KEYS.IMAGES) || '[]');
    },
    
    // Récupérer les images par catégorie
    getImagesByCategory: function(category) {
        const images = this.getAllImages();
        return category === 'all' ? images : images.filter(img => img.category === category);
    },
    
    // Récupérer les images par véhicule
    getImagesByVehicle: function(vehicleId) {
        const images = this.getAllImages();
        return images.filter(img => img.vehicleId === vehicleId);
    },
    
    // Récupérer une image par ID
    getImageById: function(imageId) {
        const images = this.getAllImages();
        return images.find(img => img.id === imageId);
    },
    
    // Ajouter une image
    addImage: function(imageData) {
        const images = this.getAllImages();
        
        // Générer un ID si non fourni
        if (!imageData.id) {
            imageData.id = 'img-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
        }
        
        // Ajouter date si non fournie
        if (!imageData.dateAdded) {
            imageData.dateAdded = new Date().toISOString();
        }
        
        images.push(imageData);
        localStorage.setItem(STORAGE_KEYS.IMAGES, JSON.stringify(images));
        
        // Mettre à jour le compteur de catégorie
        this.updateCategoryCount(imageData.category, 1);
        
        return imageData;
    },
    
    // Mettre à jour une image
    updateImage: function(imageId, updates) {
        const images = this.getAllImages();
        const index = images.findIndex(img => img.id === imageId);
        
        if (index === -1) return null;
        
        const oldImage = images[index];
        const updatedImage = {...oldImage, ...updates};
        
        // Si la catégorie a changé, mettre à jour les compteurs
        if (updates.category && updates.category !== oldImage.category) {
            this.updateCategoryCount(oldImage.category, -1);
            this.updateCategoryCount(updates.category, 1);
        }
        
        // Si le véhicule a changé, mettre à jour les associations
        if (updates.vehicleId !== undefined && updates.vehicleId !== oldImage.vehicleId) {
            if (oldImage.vehicleId) {
                this.removeImageFromVehicle(imageId, oldImage.vehicleId);
            }
            if (updates.vehicleId) {
                this.addImageToVehicle(imageId, updates.vehicleId);
            }
        }
        
        images[index] = updatedImage;
        localStorage.setItem(STORAGE_KEYS.IMAGES, JSON.stringify(images));
        
        return updatedImage;
    },
    
    // Supprimer une image
    deleteImage: function(imageId) {
        const images = this.getAllImages();
        const index = images.findIndex(img => img.id === imageId);
        
        if (index === -1) return false;
        
        const deletedImage = images[index];
        images.splice(index, 1);
        localStorage.setItem(STORAGE_KEYS.IMAGES, JSON.stringify(images));
        
        // Mettre à jour le compteur de catégorie
        this.updateCategoryCount(deletedImage.category, -1);
        
        // Si l'image était liée à un véhicule, mettre à jour
        if (deletedImage.vehicleId) {
            this.removeImageFromVehicle(imageId, deletedImage.vehicleId);
        }
        
        return true;
    },
    
    // =============== GESTION DES CATÉGORIES ===============
    
    // Récupérer toutes les catégories
    getAllCategories: function() {
        return JSON.parse(localStorage.getItem(STORAGE_KEYS.CATEGORIES) || '[]');
    },
    
    // Mettre à jour le compteur d'une catégorie
    updateCategoryCount: function(categoryId, delta) {
        const categories = this.getAllCategories();
        const index = categories.findIndex(cat => cat.id === categoryId);
        
        if (index === -1) return false;
        
        categories[index].count += delta;
        if (categories[index].count < 0) categories[index].count = 0;
        
        localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(categories));
        return true;
    },
    
    // =============== GESTION DES VÉHICULES ===============
    
    // Récupérer tous les véhicules
    getAllVehicles: function() {
        return JSON.parse(localStorage.getItem(STORAGE_KEYS.VEHICLES) || '[]');
    },
    
    // Récupérer un véhicule par ID
    getVehicleById: function(vehicleId) {
        const vehicles = this.getAllVehicles();
        return vehicles.find(v => v.id === vehicleId);
    },
    
    // Ajouter un véhicule
    addVehicle: function(vehicleData) {
        const vehicles = this.getAllVehicles();
        
        // Générer un ID si non fourni
        if (!vehicleData.id) {
            vehicleData.id = 'vehicle-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
        }
        
        // Initialiser le tableau d'images si non fourni
        if (!vehicleData.images) {
            vehicleData.images = [];
        }
        
        // Ajouter date si non fournie
        if (!vehicleData.dateAdded) {
            vehicleData.dateAdded = new Date().toISOString();
        }
        
        vehicles.push(vehicleData);
        localStorage.setItem(STORAGE_KEYS.VEHICLES, JSON.stringify(vehicles));
        
        return vehicleData;
    },
    
    // Mettre à jour un véhicule
    updateVehicle: function(vehicleId, updates) {
        const vehicles = this.getAllVehicles();
        const index = vehicles.findIndex(v => v.id === vehicleId);
        
        if (index === -1) return null;
        
        const updatedVehicle = {...vehicles[index], ...updates};
        vehicles[index] = updatedVehicle;
        
        localStorage.setItem(STORAGE_KEYS.VEHICLES, JSON.stringify(vehicles));
        return updatedVehicle;
    },
    
    // Supprimer un véhicule
    deleteVehicle: function(vehicleId) {
        const vehicles = this.getAllVehicles();
        const index = vehicles.findIndex(v => v.id === vehicleId);
        
        if (index === -1) return false;
        
        // Récupérer les images associées pour mettre à jour leurs associations
        const vehicleImages = this.getImagesByVehicle(vehicleId);
        
        // Supprimer le véhicule
        vehicles.splice(index, 1);
        localStorage.setItem(STORAGE_KEYS.VEHICLES, JSON.stringify(vehicles));
        
        // Mettre à jour les images associées
        vehicleImages.forEach(img => {
            this.updateImage(img.id, {vehicleId: null, vehicleName: ''});
        });
        
        return true;
    },
    
    // Ajouter une image à un véhicule
    addImageToVehicle: function(imageId, vehicleId) {
        const vehicles = this.getAllVehicles();
        const vehicleIndex = vehicles.findIndex(v => v.id === vehicleId);
        
        if (vehicleIndex === -1) return false;
        
        // Initialiser le tableau d'images si nécessaire
        if (!vehicles[vehicleIndex].images) {
            vehicles[vehicleIndex].images = [];
        }
        
        // Ajouter l'ID de l'image s'il n'existe pas déjà
        if (!vehicles[vehicleIndex].images.includes(imageId)) {
            vehicles[vehicleIndex].images.push(imageId);
            localStorage.setItem(STORAGE_KEYS.VEHICLES, JSON.stringify(vehicles));
            
            // Mettre à jour l'image avec les infos du véhicule
            const vehicle = vehicles[vehicleIndex];
            this.updateImage(imageId, {
                vehicleId: vehicleId,
                vehicleName: `${vehicle.make} ${vehicle.model} ${vehicle.year || ''}`
            });
        }
        
        return true;
    },
    
    // Supprimer une image d'un véhicule
    removeImageFromVehicle: function(imageId, vehicleId) {
        const vehicles = this.getAllVehicles();
        const vehicleIndex = vehicles.findIndex(v => v.id === vehicleId);
        
        if (vehicleIndex === -1 || !vehicles[vehicleIndex].images) return false;
        
        const imageIndex = vehicles[vehicleIndex].images.indexOf(imageId);
        if (imageIndex > -1) {
            vehicles[vehicleIndex].images.splice(imageIndex, 1);
            localStorage.setItem(STORAGE_KEYS.VEHICLES, JSON.stringify(vehicles));
            
            // Mettre à jour l'image pour supprimer l'association
            this.updateImage(imageId, {vehicleId: null, vehicleName: ''});
        }
        
        return true;
    },
    
    // =============== UTILITAIRES ===============
    
    // Formatter la taille de fichier
    formatFileSize: function(bytes) {
        if (bytes === undefined || bytes === null) return 'Inconnu';
        if (bytes === 0) return '0 Bytes';
        
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    },
    
    // Vider toutes les données (pour tests)
    clearAllData: function() {
        localStorage.removeItem(STORAGE_KEYS.IMAGES);
        localStorage.removeItem(STORAGE_KEYS.VEHICLES);
        localStorage.removeItem(STORAGE_KEYS.CATEGORIES);
        this.init();
    }
};

// Initialiser le service de données au chargement
document.addEventListener('DOMContentLoaded', function() {
    DataService.init();
});
// Affichage dynamique des véhicules dans le panneau d'administration
document.addEventListener('DOMContentLoaded', function() {
    const vehiclesContainer = document.querySelector('.vehicles-grid');
    if (!vehiclesContainer) return;
    
    // Fonction pour rafraîchir l'affichage des véhicules
    function refreshVehicles() {

        // Debugger les associations image-véhicule
console.log("=== DÉBUG DES ASSOCIATIONS VÉHICULES-IMAGES ===");
const allVehicles = DataService.getAllVehicles();
allVehicles.forEach(vehicle => {
    console.log(`Véhicule: ${vehicle.make} ${vehicle.model}, ID: ${vehicle.id}`);
    console.log(`  Images associées:`, vehicle.images);
    
    if (vehicle.images && vehicle.images.length > 0) {
        vehicle.images.forEach(imageId => {
            const image = DataService.getImageById(imageId);
            console.log(`    - Image ${imageId}: ${image ? "✓ trouvée" : "❌ non trouvée"}`);
        });
    } else {
        console.log("  Aucune image associée");
    }
});
        // Vider le conteneur
        vehiclesContainer.innerHTML = '';
        
        // Récupérer tous les véhicules
        const vehicles = DataService.getAllVehicles();
        
        if (vehicles.length === 0) {
            vehiclesContainer.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 30px;">
                    <i class="fas fa-car" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                    <p>Aucun véhicule dans la base de données.</p>
                    <p>Utilisez le bouton "Ajouter un véhicule" pour commencer.</p>
                </div>
            `;
            return;
        }
        
        // Créer une carte pour chaque véhicule
        vehicles.forEach(vehicle => {
            const vehicleCard = createVehicleCard(vehicle);
            vehiclesContainer.appendChild(vehicleCard);
        });
    }
    
    // Fonction pour créer une carte de véhicule
// Fonction pour créer une carte de véhicule
// Fonction pour créer une carte de véhicule
function createVehicleCard(vehicle) {
    const card = document.createElement('div');
    card.className = 'vehicle-card';
    card.dataset.vehicleId = vehicle.id;
    
    // Trouver l'image principale du véhicule avec meilleure gestion d'erreur
    let imageSrc = '/api/placeholder/400/320';
    let imageAlt = `${vehicle.make} ${vehicle.model} - Vue frontale`;
    
    // Vérification améliorée pour les images
    if (vehicle.images && vehicle.images.length > 0) {
        console.log(`Véhicule ${vehicle.id}: cherche image avec ID ${vehicle.images[0]}`);
        
        // Tenter de récupérer la première image
        const vehicleImage = DataService.getImageById(vehicle.images[0]);
        
        if (vehicleImage) {
            console.log(`Image trouvée: ${vehicleImage.id}`);
            
            if (vehicleImage.src && typeof vehicleImage.src === 'string') {
                imageSrc = vehicleImage.src;
                imageAlt = vehicleImage.alt || imageAlt;
                console.log(`Utilisation de l'image: ${vehicleImage.id}`);
            } else {
                console.warn(`Image sans source valide: ${vehicleImage.id}`);
            }
        } else {
            console.warn(`Image non trouvée: ${vehicle.images[0]}`);
        }
    }
    
    // Déterminer le statut du véhicule (vente ou location)
    const statusClass = vehicle.type === 'rent' ? 'status-rent' : 'status-sale';
    const statusText = vehicle.type === 'rent' ? 'Location' : 'Vente';
    
    // Formatage du prix
    const priceValue = parseFloat(vehicle.price) || 0;
    const formattedPrice = vehicle.type === 'sale' 
        ? `${priceValue.toLocaleString()} FCFA` 
        : `${priceValue.toLocaleString()} FCFA / jour`;
    
    // Création du contenu HTML avec gestion d'erreur d'image
    card.innerHTML = `
        <div class="vehicle-card-header">
            <img src="${imageSrc}" alt="${imageAlt}" class="vehicle-img" 
                 onerror="this.src='/api/placeholder/400/320'; this.onerror=null; console.warn('Erreur chargement image pour ${vehicle.id}');">
            <div class="vehicle-status ${statusClass}">${statusText}</div>
            <div class="vehicle-card-actions">
                <button class="action-btn edit-vehicle" title="Modifier" data-vehicle-id="${vehicle.id}"><i class="fas fa-edit"></i></button>
                <button class="action-btn delete-vehicle" title="Supprimer" data-vehicle-id="${vehicle.id}"><i class="fas fa-trash-alt"></i></button>
            </div>
        </div>
        <div class="vehicle-card-body">
            <h3 class="vehicle-title">${vehicle.make} ${vehicle.model} ${vehicle.year || ''}</h3>
            <div class="vehicle-price">${formattedPrice}</div>
            <div class="vehicle-details">
                ${vehicle.type === 'sale' ? `
                    <span class="vehicle-detail"><i class="fas fa-tachometer-alt"></i> ${vehicle.mileage || '0'} km</span>
                    <span class="vehicle-detail"><i class="fas fa-gas-pump"></i> ${vehicle.fuel || 'Non spécifié'}</span>
                    <span class="vehicle-detail"><i class="fas fa-cog"></i> ${vehicle.transmission || 'Non spécifié'}</span>
                ` : `
                    <span class="vehicle-detail"><i class="fas fa-user"></i> ${vehicle.seats || '5'} places</span>
                    <span class="vehicle-detail"><i class="fas fa-suitcase"></i> ${vehicle.baggage || '4'} bags</span>
                    <span class="vehicle-detail"><i class="fas fa-snowflake"></i> Clim</span>
                `}
            </div>
        </div>
    `;
    
    // Ajouter les événements
    const editButton = card.querySelector('.edit-vehicle');
    const deleteButton = card.querySelector('.delete-vehicle');
    
    if (editButton) {
        editButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            editVehicle(vehicle.id);
        });
    }
    
    if (deleteButton) {
        deleteButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            deleteVehicle(vehicle.id);
        });
    }
    
    return card;
}
    
  // Fonction pour vérifier l'état des données
function inspectLocalStorageData() {
    // Récupérer les données brutes du localStorage
    const rawImages = localStorage.getItem(STORAGE_KEYS.IMAGES);
    const rawVehicles = localStorage.getItem(STORAGE_KEYS.VEHICLES);
    
    console.log("=== INSPECTION DES DONNÉES ===");
    console.log(`Taille des données images: ${rawImages ? rawImages.length : 0} caractères`);
    console.log(`Taille des données véhicules: ${rawVehicles ? rawVehicles.length : 0} caractères`);
    
    // Si les données sont trop volumineuses, c'est peut-être la cause du problème
    if (rawImages && rawImages.length > 5000000) {
        console.warn("ATTENTION: Les données d'images sont très volumineuses (>5MB)!");
        console.warn("Cela pourrait dépasser les limites du localStorage.");
        
        // Vérifier les tailles individuelles des images
        const images = JSON.parse(rawImages);
        images.forEach(img => {
            if (img.src && img.src.length > 1000000) {
                console.warn(`Image ${img.id}: Taille excessive (${Math.round(img.src.length/1024/1024*100)/100}MB)`);
            }
        });
    }
    
    return {
        imagesSize: rawImages ? rawImages.length : 0,
        vehiclesSize: rawVehicles ? rawVehicles.length : 0
    };
}

// Appelez cette fonction au chargement
document.addEventListener('DOMContentLoaded', function() {
    const storageInfo = inspectLocalStorageData();
    
    // Si les données sont trop volumineuses, affichez un avertissement
    if (storageInfo.imagesSize > 5000000) {
        const warning = document.createElement('div');
        warning.style.position = 'fixed';
        warning.style.top = '10px';
        warning.style.left = '10px';
        warning.style.right = '10px';
        warning.style.backgroundColor = '#ffecb3';
        warning.style.color = '#856404';
        warning.style.padding = '10px';
        warning.style.borderRadius = '4px';
        warning.style.zIndex = '9999';
        warning.innerHTML = `
            <strong>Attention:</strong> Les données d'images sont très volumineuses (${Math.round(storageInfo.imagesSize/1024/1024*100)/100}MB).
            Cela peut dépasser les limites du localStorage et causer des problèmes d'affichage.
            <button style="margin-left: 10px; padding: 5px 10px;">Comprendre</button>
        `;
        
        document.body.appendChild(warning);
    }
});  // Fonction pour éditer un véhicule
// Fonction pour éditer un véhicule
function editVehicle(vehicleId) {
    const vehicle = DataService.getVehicleById(vehicleId);
    if (!vehicle) return;
    
    // Ouvrir le modal d'édition
    const modal = document.getElementById('addVehicleModal');
    if (!modal) return;
    
    // Mettre à jour le titre du modal
    const modalTitle = modal.querySelector('.modal-title');
    if (modalTitle) modalTitle.textContent = 'Modifier un véhicule';
    
    // Remplir le formulaire avec les données du véhicule
    document.getElementById('vehicleType').value = vehicle.type || 'sale';
    document.getElementById('vehicleMake').value = vehicle.make || '';
    document.getElementById('vehicleModel').value = vehicle.model || '';
    document.getElementById('vehicleYear').value = vehicle.year || '';
    document.getElementById('vehiclePrice').value = vehicle.price || '';
    document.getElementById('vehicleMileage').value = vehicle.mileage || '';
    document.getElementById('vehicleFuel').value = vehicle.fuel || 'essence';
    document.getElementById('vehicleTransmission').value = vehicle.transmission || 'manual';
    document.getElementById('vehicleDescription').value = vehicle.description || '';
    
    // Ajouter l'ID du véhicule comme attribut data au formulaire
    const form = document.getElementById('addVehicleForm');
    if (form) {
        form.dataset.vehicleId = vehicleId;
        
        // Stocker également les images actuelles
        if (vehicle.images && Array.isArray(vehicle.images)) {
            form.setAttribute('data-selected-images', JSON.stringify(vehicle.images));
        } else {
            form.setAttribute('data-selected-images', '[]');
        }
    }
    
    // Afficher le modal
    modal.classList.add('active');
    
    // Configurer le bouton de sauvegarde
    const saveButton = document.getElementById('saveVehicle');
    if (saveButton) {
        // Remplacer l'ancien écouteur d'événements
        const newSaveButton = saveButton.cloneNode(true);
        saveButton.parentNode.replaceChild(newSaveButton, saveButton);
        
        newSaveButton.addEventListener('click', function() {
            saveVehicleChanges(vehicleId);
        });
    }
    
    // Si l'onglet "Sélectionner des images existantes" est disponible
    const selectImagesTab = document.querySelector('[data-image-tab="select"]');
    if (selectImagesTab) {
        // Simuler un clic sur cet onglet pour charger les images
        setTimeout(() => {
            selectImagesTab.click();
        }, 100);
    }
    }
    
    // Fonction pour sauvegarder les modifications d'un véhicule
// Fonction pour sauvegarder les modifications d'un véhicule
function saveVehicleChanges(vehicleId) {
    // Récupérer les valeurs du formulaire
    const type = document.getElementById('vehicleType').value;
    const make = document.getElementById('vehicleMake').value;
    const model = document.getElementById('vehicleModel').value;
    const year = document.getElementById('vehicleYear').value;
    const price = document.getElementById('vehiclePrice').value;
    const mileage = document.getElementById('vehicleMileage').value;
    const fuel = document.getElementById('vehicleFuel').value;
    const transmission = document.getElementById('vehicleTransmission').value;
    const description = document.getElementById('vehicleDescription').value;
    
    // Validation des champs obligatoires
    if (!make || !model || !price) {
        alert('Veuillez remplir tous les champs obligatoires (marque, modèle, prix).');
        return;
    }
    
    // Récupérer les images sélectionnées
    const form = document.getElementById('addVehicleForm');
    let selectedImageIds = [];
    
    if (form && form.hasAttribute('data-selected-images')) {
        try {
            selectedImageIds = JSON.parse(form.getAttribute('data-selected-images'));
            console.log("Images sélectionnées:", selectedImageIds);
        } catch (e) {
            console.error('Erreur lors de la lecture des images sélectionnées:', e);
        }
    }
    
    // Récupérer les images actuelles si c'est une modification
    let currentImageIds = [];
    if (vehicleId) {
        const currentVehicle = DataService.getVehicleById(vehicleId);
        if (currentVehicle && currentVehicle.images) {
            currentImageIds = [...currentVehicle.images];
        }
    }
    
    // Créer l'objet de mise à jour
    const vehicleData = {
        type,
        make,
        model,
        year,
        price,
        mileage,
        fuel,
        transmission,
        description,
        images: selectedImageIds
    };
    
    let newVehicleId;
    
    // Si c'est un nouveau véhicule
    if (!vehicleId) {
        // Ajouter le véhicule
        const newVehicle = DataService.addVehicle(vehicleData);
        newVehicleId = newVehicle.id;
        console.log("Nouveau véhicule créé avec ID:", newVehicleId);
    } else {
        // Mettre à jour le véhicule existant
        DataService.updateVehicle(vehicleId, vehicleData);
        newVehicleId = vehicleId;
        console.log("Véhicule mis à jour, ID:", newVehicleId);
    }
    
    // CORRECTION CRITIQUE: Mettre à jour correctement les associations d'images
    const vehicleName = `${make} ${model} ${year || ''}`;
    
    // 1. Mettre à jour le véhicule avec les nouvelles images
    selectedImageIds.forEach(imageId => {
        const image = DataService.getImageById(imageId);
        if (image) {
            console.log(`Association: image ${imageId} -> véhicule ${newVehicleId}`);
            // Mise à jour bidirectionnelle
            DataService.updateImage(imageId, {
                vehicleId: newVehicleId,
                vehicleName: vehicleName
            });
        }
    });
    
    // 2. Dissocier les images qui ont été retirées
    currentImageIds.forEach(imageId => {
        if (!selectedImageIds.includes(imageId)) {
            const image = DataService.getImageById(imageId);
            if (image && image.vehicleId === newVehicleId) {
                console.log(`Dissociation: image ${imageId} <-> véhicule ${newVehicleId}`);
                DataService.updateImage(imageId, { 
                    vehicleId: null, 
                    vehicleName: '' 
                });
            }
        }
    });
    
    // Fermer le modal
    const modal = document.getElementById('addVehicleModal');
    if (modal) modal.classList.remove('active');
    
    // Rafraîchir l'affichage
    refreshVehicles();
    
    // Informer l'utilisateur
    alert(vehicleId ? 'Véhicule mis à jour avec succès!' : 'Véhicule ajouté avec succès!');
}
    
    // Fonction pour supprimer un véhicule
    function deleteVehicle(vehicleId) {
        if (!confirm('Êtes-vous sûr de vouloir supprimer ce véhicule?')) return;
        
        // Supprimer le véhicule
        const success = DataService.deleteVehicle(vehicleId);
        
        if (success) {
            // Rafraîchir l'affichage
            refreshVehicles();
            alert('Véhicule supprimé avec succès!');
        } else {
            alert('Erreur lors de la suppression du véhicule.');
        }
    }
    
    // Configurer le bouton d'ajout
    const addButton = document.getElementById('openAddVehicleModal');
    if (addButton) {
        addButton.addEventListener('click', function() {
            // Réinitialiser le formulaire
            const form = document.getElementById('addVehicleForm');
            if (form) {
                form.reset();
                form.removeAttribute('data-vehicle-id');
            }
            
            // Mettre à jour le titre du modal
            const modalTitle = document.querySelector('#addVehicleModal .modal-title');
            if (modalTitle) modalTitle.textContent = 'Ajouter un nouveau véhicule';
            
            // Configurer le bouton de sauvegarde
            const saveButton = document.getElementById('saveVehicle');
            if (saveButton) {
                // Remplacer l'ancien écouteur d'événements
                const newSaveButton = saveButton.cloneNode(true);
                saveButton.parentNode.replaceChild(newSaveButton, saveButton);
                
                newSaveButton.addEventListener('click', function() {
                    saveVehicleChanges(null); // null indique un nouveau véhicule
                });
            }
            
            // Ouvrir le modal
            const modal = document.getElementById('addVehicleModal');
            if (modal) modal.classList.add('active');
        });
    }
    
    // Afficher les véhicules initialement
    refreshVehicles();
});
// Fonctionnalité de recherche de véhicules
const searchInput = document.getElementById('vehicle-search');
if (searchInput) {
    searchInput.addEventListener('input', function() {
        const searchText = this.value.toLowerCase();
        
        // Récupérer toutes les cartes de véhicules
        const vehicleCards = document.querySelectorAll('.vehicle-card');
        
        vehicleCards.forEach(card => {
            const title = card.querySelector('.vehicle-title').textContent.toLowerCase();
            const price = card.querySelector('.vehicle-price').textContent.toLowerCase();
            const details = card.querySelector('.vehicle-details').textContent.toLowerCase();
            
            if (title.includes(searchText) || price.includes(searchText) || details.includes(searchText)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });
}

// Fonctionnalité de filtrage par type
const typeLinks = document.querySelectorAll('#type-dropdown .dropdown-item');
typeLinks.forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Mettre à jour l'état actif
        typeLinks.forEach(l => l.classList.remove('active'));
        this.classList.add('active');
        
        const filterType = this.getAttribute('href').substring(1); // Enlever le #
        
        // Récupérer toutes les cartes de véhicules
        const vehicleCards = document.querySelectorAll('.vehicle-card');
        
        vehicleCards.forEach(card => {
            if (filterType === 'all') {
                card.style.display = '';
            } else {
                const isVente = card.querySelector('.vehicle-status').textContent === 'Vente';
                const isLocation = card.querySelector('.vehicle-status').textContent === 'Location';
                
                if ((filterType === 'vente' && isVente) || (filterType === 'location' && isLocation)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            }
        });
    });
});

// Gestion de la sélection d'images existantes pour les véhicules
document.addEventListener('DOMContentLoaded', function() {
    // Gestion des onglets d'images
    const imageTabs = document.querySelectorAll('[data-image-tab]');
    const tabContents = document.querySelectorAll('.tab-content');
    
    imageTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabType = this.getAttribute('data-image-tab');
            
            // Mettre à jour les onglets actifs
            imageTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Afficher le contenu correspondant
            tabContents.forEach(content => {
                content.style.display = 'none';
            });
            
            if (tabType === 'upload') {
                document.getElementById('upload-tab-content').style.display = 'block';
            } else if (tabType === 'select') {
                document.getElementById('select-tab-content').style.display = 'block';
                loadAvailableImages();
            }
        });
    });
    
    // Fonction pour charger les images disponibles
    function loadAvailableImages() {
        const container = document.getElementById('available-images-container');
        if (!container) return;
        
        // Vider le conteneur sauf l'indicateur de chargement
        const loadingIndicator = container.querySelector('.loading-indicator');
        container.innerHTML = '';
        if (loadingIndicator) container.appendChild(loadingIndicator);
        
        // Récupérer toutes les images disponibles
        const images = DataService.getAllImages();
        
        // Masquer l'indicateur de chargement
        if (loadingIndicator) loadingIndicator.style.display = 'none';
        
        if (images.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #777;">
                    <i class="fas fa-images" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <p>Aucune image disponible.</p>
                    <p>Utilisez le gestionnaire d'images pour en ajouter.</p>
                </div>
            `;
            return;
        }
        
        // Récupérer l'ID du véhicule en cours d'édition
        const form = document.getElementById('addVehicleForm');
        const vehicleId = form ? form.dataset.vehicleId : null;
        let selectedImageIds = [];
        
        // Si on édite un véhicule existant, récupérer ses images
        if (vehicleId) {
            const vehicle = DataService.getVehicleById(vehicleId);
            if (vehicle && vehicle.images) {
                selectedImageIds = [...vehicle.images];
            }
        }
        
        // Créer les miniatures d'images
        images.forEach(image => {
            const isSelected = selectedImageIds.includes(image.id);
            const imageItem = createImageThumbnail(image, isSelected);
            container.appendChild(imageItem);
        });
        
        // Mettre à jour l'affichage des images sélectionnées
        updateSelectedImagesDisplay(selectedImageIds);
        
        // Fonction pour la recherche d'images
        const searchInput = document.getElementById('image-search');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchText = this.value.toLowerCase();
                const imageItems = container.querySelectorAll('.image-thumbnail-item');
                
                imageItems.forEach(item => {
                    const imageName = item.getAttribute('data-name').toLowerCase();
                    const imageCategory = item.getAttribute('data-category').toLowerCase();
                    
                    if (imageName.includes(searchText) || imageCategory.includes(searchText)) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }
    }
    
    // Fonction pour créer une miniature d'image
    function createImageThumbnail(image, isSelected = false) {
        const item = document.createElement('div');
        item.className = 'image-thumbnail-item';
        item.style.position = 'relative';
        item.style.borderRadius = '5px';
        item.style.overflow = 'hidden';
        item.style.cursor = 'pointer';
        item.style.border = isSelected ? '3px solid var(--primary-color)' : '3px solid transparent';
        item.setAttribute('data-id', image.id);
        item.setAttribute('data-name', image.fileName || '');
        item.setAttribute('data-category', image.category || '');
        
        // Image
        const img = document.createElement('img');
        img.src = image.src;
        img.alt = image.alt || image.fileName;
        img.style.width = '100%';
        img.style.height = '70px';
        img.style.objectFit = 'cover';
        
        // Indicateur de sélection
        const checkbox = document.createElement('span');
        checkbox.className = 'image-select-indicator';
        checkbox.innerHTML = '<i class="fas fa-check-circle"></i>';
        checkbox.style.position = 'absolute';
        checkbox.style.top = '5px';
        checkbox.style.right = '5px';
        checkbox.style.color = 'var(--primary-color)';
        checkbox.style.background = 'rgba(255, 255, 255, 0.7)';
        checkbox.style.borderRadius = '50%';
        checkbox.style.padding = '2px';
        checkbox.style.display = isSelected ? 'block' : 'none';
        
        // Info
        const info = document.createElement('div');
        info.className = 'image-thumbnail-info';
        info.style.padding = '5px';
        info.style.fontSize = '0.7rem';
        info.style.whiteSpace = 'nowrap';
        info.style.overflow = 'hidden';
        info.style.textOverflow = 'ellipsis';
        info.style.backgroundColor = 'rgba(0, 0, 0, 0.05)';
        info.textContent = image.fileName || 'Image';
        
        // Assembler
        item.appendChild(img);
        item.appendChild(checkbox);
        item.appendChild(info);
        
        // Événement de clic pour sélectionner/désélectionner
        item.addEventListener('click', function() {
            const form = document.getElementById('addVehicleForm');
            if (!form) return;
            
            // Récupérer les IDs sélectionnés actuels
            const vehicleId = form.dataset.vehicleId;
            let selectedImageIds = [];
            
            if (vehicleId) {
                const vehicle = DataService.getVehicleById(vehicleId);
                if (vehicle && vehicle.images) {
                    selectedImageIds = [...vehicle.images];
                }
            }
            
            const imageId = this.getAttribute('data-id');
            const isCurrentlySelected = selectedImageIds.includes(imageId);
            
            if (isCurrentlySelected) {
                // Désélectionner
                selectedImageIds = selectedImageIds.filter(id => id !== imageId);
                this.style.border = '3px solid transparent';
                this.querySelector('.image-select-indicator').style.display = 'none';
            } else {
                // Sélectionner
                selectedImageIds.push(imageId);
                this.style.border = '3px solid var(--primary-color)';
                this.querySelector('.image-select-indicator').style.display = 'block';
            }
            
            // Stocker temporairement les IDs sélectionnés
            form.setAttribute('data-selected-images', JSON.stringify(selectedImageIds));
            
            // Mettre à jour l'affichage des images sélectionnées
            updateSelectedImagesDisplay(selectedImageIds);
        });
        
        return item;
    }
    
    // Fonction pour mettre à jour l'affichage des images sélectionnées
 // Fonction pour mettre à jour l'affichage des images sélectionnées
function updateSelectedImagesDisplay(selectedImageIds) {
    const container = document.getElementById('selected-images');
    if (!container) return;
    
    // Vider le conteneur
    container.innerHTML = '';
    
    // Mise à jour du formulaire avec les images sélectionnées
    const form = document.getElementById('addVehicleForm');
    if (form) {
        form.setAttribute('data-selected-images', JSON.stringify(selectedImageIds));
        console.log("Images sélectionnées mises à jour:", selectedImageIds);
    }
    
    if (selectedImageIds.length === 0) {
        container.innerHTML = `
            <div class="empty-selection" style="width: 100%; text-align: center; padding: 15px; color: #777; font-style: italic;">
                Aucune image sélectionnée
            </div>
        `;
        return;
    }
    
    // Afficher chaque image sélectionnée
    selectedImageIds.forEach(imageId => {
        const image = DataService.getImageById(imageId);
        if (!image) return;
        
        const item = document.createElement('div');
        item.className = 'selected-image-item';
        item.style.position = 'relative';
        item.style.width = '100px';
        item.style.borderRadius = '5px';
        item.style.overflow = 'hidden';
        item.setAttribute('data-id', image.id);
        
        // Image
        const img = document.createElement('img');
        img.src = image.src || '/api/placeholder/100/100';
        img.alt = image.alt || image.fileName || 'Image';
        img.style.width = '100%';
        img.style.height = '70px';
        img.style.objectFit = 'cover';
        img.onerror = function() {
            this.src = '/api/placeholder/100/100';
            this.onerror = null;
        };
        
        // Bouton de suppression
        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-selected-image';
        removeBtn.innerHTML = '<i class="fas fa-times"></i>';
        removeBtn.style.position = 'absolute';
        removeBtn.style.top = '5px';
        removeBtn.style.right = '5px';
        removeBtn.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        removeBtn.style.color = 'white';
        removeBtn.style.border = 'none';
        removeBtn.style.borderRadius = '50%';
        removeBtn.style.width = '20px';
        removeBtn.style.height = '20px';
        removeBtn.style.cursor = 'pointer';
        removeBtn.style.display = 'flex';
        removeBtn.style.alignItems = 'center';
        removeBtn.style.justifyContent = 'center';
        
        // Info
        const info = document.createElement('div');
        info.className = 'image-thumbnail-info';
        info.style.padding = '5px';
        info.style.fontSize = '0.7rem';
        info.style.whiteSpace = 'nowrap';
        info.style.overflow = 'hidden';
        info.style.textOverflow = 'ellipsis';
        info.style.backgroundColor = 'rgba(0, 0, 0, 0.05)';
        info.textContent = image.fileName || 'Image';
        
        // Assembler
        item.appendChild(img);
        item.appendChild(removeBtn);
        item.appendChild(info);
        
        // Événement de clic pour supprimer
        removeBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            
            // Récupérer les IDs sélectionnés actuels
            const newSelectedIds = selectedImageIds.filter(id => id !== imageId);
            
            // Mettre à jour l'affichage avec les nouveaux IDs
            updateSelectedImagesDisplay(newSelectedIds);
        });
        
        container.appendChild(item);
    });
}
    
    // Modifier la fonction de sauvegarde pour inclure les images sélectionnées
    const originalSaveVehicleChanges = window.saveVehicleChanges;
    window.saveVehicleChanges = function(vehicleId) {
    // Récupérer les valeurs du formulaire
    const type = document.getElementById('vehicleType').value;
    const make = document.getElementById('vehicleMake').value;
    const model = document.getElementById('vehicleModel').value;
    const year = document.getElementById('vehicleYear').value;
    const price = document.getElementById('vehiclePrice').value;
    const mileage = document.getElementById('vehicleMileage').value;
    const fuel = document.getElementById('vehicleFuel').value;
    const transmission = document.getElementById('vehicleTransmission').value;
    const description = document.getElementById('vehicleDescription').value;
    
    // Validation des champs obligatoires
    if (!make || !model || !price) {
        alert('Veuillez remplir tous les champs obligatoires (marque, modèle, prix).');
        return;
    }
    
    // Récupérer les images sélectionnées
    const form = document.getElementById('addVehicleForm');
    let selectedImageIds = [];
    
    if (form && form.hasAttribute('data-selected-images')) {
        try {
            selectedImageIds = JSON.parse(form.getAttribute('data-selected-images'));
            console.log("Images sélectionnées récupérées:", selectedImageIds);
        } catch (e) {
            console.error('Erreur lors de la lecture des images sélectionnées:', e);
        }
    }
    
    // Récupérer les images actuelles si c'est une modification
    let currentImageIds = [];
    if (vehicleId) {
        const currentVehicle = DataService.getVehicleById(vehicleId);
        if (currentVehicle && currentVehicle.images) {
            currentImageIds = [...currentVehicle.images];
            console.log("Images actuelles du véhicule:", currentImageIds);
        }
    }
    
    // Créer l'objet de mise à jour
    const vehicleData = {
        type,
        make,
        model,
        year,
        price,
        mileage,
        fuel,
        transmission,
        description,
        images: selectedImageIds
    };
    
    let newVehicleId;
    
    // Si c'est un nouveau véhicule
    if (!vehicleId) {
        // Ajouter le véhicule
        const newVehicle = DataService.addVehicle(vehicleData);
        newVehicleId = newVehicle.id;
        console.log("Nouveau véhicule créé avec ID:", newVehicleId);
    } else {
        // Mettre à jour le véhicule existant
        DataService.updateVehicle(vehicleId, vehicleData);
        newVehicleId = vehicleId;
        console.log("Véhicule mis à jour, ID:", newVehicleId);
    }
    
    // Trouver les images à ajouter et à supprimer
    const imagesToAdd = selectedImageIds.filter(id => !currentImageIds.includes(id));
    const imagesToRemove = currentImageIds.filter(id => !selectedImageIds.includes(id));
    
    console.log("Images à ajouter:", imagesToAdd);
    console.log("Images à supprimer:", imagesToRemove);
    
    // Ajouter les nouvelles associations
    imagesToAdd.forEach(imageId => {
        console.log(`Ajout de l'association: image ${imageId} -> véhicule ${newVehicleId}`);
        DataService.addImageToVehicle(imageId, newVehicleId);
    });
    
    // Supprimer les anciennes associations
    imagesToRemove.forEach(imageId => {
        console.log(`Suppression de l'association: image ${imageId} -> véhicule ${newVehicleId}`);
        DataService.removeImageFromVehicle(imageId, newVehicleId);
    });
    
    // Vérifier que toutes les images ont une association bidirectionnelle
    selectedImageIds.forEach(imageId => {
        const image = DataService.getImageById(imageId);
        if (image && image.vehicleId !== newVehicleId) {
            console.log(`Correction de l'association incohérente: image ${imageId} -> véhicule ${newVehicleId}`);
            DataService.updateImage(imageId, {
                vehicleId: newVehicleId,
                vehicleName: `${make} ${model} ${year || ''}`
            });
        }
    });
    
    // Fermer le modal
    const modal = document.getElementById('addVehicleModal');
    if (modal) modal.classList.remove('active');
    
    // Rafraîchir l'affichage
    if (typeof refreshVehicles === 'function') {
        refreshVehicles();
    }
    
    // Informer l'utilisateur
    alert(vehicleId ? 'Véhicule mis à jour avec succès!' : 'Véhicule ajouté avec succès!');
};
});
// Script d'amélioration pour l'affichage des véhicules sur le frontend
document.addEventListener('DOMContentLoaded', function() {
    // Vérifier si nous sommes sur une page qui affiche des véhicules
    const saleVehiclesContainer = document.querySelector('#vehicles .vehicles-grid');
    const rentVehiclesContainer = document.querySelector('#rent .vehicles-grid');
    
    if (!saleVehiclesContainer && !rentVehiclesContainer) return;
    
    console.log("Initialisation de l'affichage des véhicules...");
    
    // Fonction pour créer une carte de véhicule
    function createFrontendVehicleCard(vehicle) {
        const card = document.createElement('div');
        card.className = 'card vehicle-card';
        
        // Trouver l'image principale du véhicule
        let imageSrc = '/api/placeholder/400/320';
        let imageAlt = `${vehicle.make} ${vehicle.model} - Vue frontale`;
        
        if (vehicle.images && vehicle.images.length > 0) {
            // Tenter de récupérer la première image
            const vehicleImage = DataService.getImageById(vehicle.images[0]);
            if (vehicleImage && vehicleImage.src) {
                imageSrc = vehicleImage.src;
                imageAlt = vehicleImage.alt || imageAlt;
            }
        }
        
        // Formatage du prix
        const priceValue = parseFloat(vehicle.price) || 0;
        const formattedPrice = vehicle.type === 'sale' 
            ? `${priceValue.toLocaleString()} FCFA` 
            : `${priceValue.toLocaleString()} FCFA / jour`;
        
        // Contenu HTML
        if (vehicle.type === 'sale') {
            card.innerHTML = `
                <img src="${imageSrc}" alt="${imageAlt}" class="vehicle-image" 
                     onerror="this.src='/api/placeholder/400/320'; this.onerror=null;">
                <div class="vehicle-content">
                    <h3 class="vehicle-title">${vehicle.make} ${vehicle.model} ${vehicle.year || ''}</h3>
                    <p class="vehicle-price">${formattedPrice}</p>
                    <div class="vehicle-features">
                        <span class="vehicle-feature"><i class="fas fa-tachometer-alt"></i> ${vehicle.mileage || '0'} km</span>
                        <span class="vehicle-feature"><i class="fas fa-gas-pump"></i> ${vehicle.fuel || 'Non spécifié'}</span>
                        <span class="vehicle-feature"><i class="fas fa-cog"></i> ${vehicle.transmission || 'Non spécifié'}</span>
                    </div>
                    <div class="vehicle-buttons">
                        <a href="#" class="btn" data-id="${vehicle.id}">Détails</a>
                        <a href="#" class="btn btn-outline" data-id="${vehicle.id}">Contacter</a>
                    </div>
                </div>
            `;
        } else {
            card.innerHTML = `
                <img src="${imageSrc}" alt="${imageAlt}" class="vehicle-image" 
                     onerror="this.src='/api/placeholder/400/320'; this.onerror=null;">
                <div class="vehicle-content">
                    <h3 class="vehicle-title">${vehicle.make} ${vehicle.model} ${vehicle.year || ''}</h3>
                    <p class="vehicle-price">${formattedPrice}</p>
                    <div class="vehicle-features">
                        <span class="vehicle-feature"><i class="fas fa-user"></i> ${vehicle.seats || '5'} places</span>
                        <span class="vehicle-feature"><i class="fas fa-suitcase"></i> ${vehicle.baggage || '4'} bagages</span>
                        <span class="vehicle-feature"><i class="fas fa-snowflake"></i> Climatisé</span>
                    </div>
                    <div class="vehicle-buttons">
                        <a href="#" class="btn" data-id="${vehicle.id}">Réserver</a>
                        <a href="#" class="btn btn-outline" data-id="${vehicle.id}">Plus d'infos</a>
                    </div>
                </div>
            `;
        }
        
        return card;
    }
    
    // Fonction pour afficher les véhicules
    function displayVehicles() {
        // Récupérer tous les véhicules
        const vehicles = DataService.getAllVehicles();
        
        if (vehicles.length === 0) {
            if (saleVehiclesContainer) {
                saleVehiclesContainer.innerHTML = '<div class="card vehicle-card"><div class="vehicle-content" style="padding:20px;text-align:center;">Aucun véhicule à vendre disponible.</div></div>';
            }
            if (rentVehiclesContainer) {
                rentVehiclesContainer.innerHTML = '<div class="card vehicle-card"><div class="vehicle-content" style="padding:20px;text-align:center;">Aucun véhicule à louer disponible.</div></div>';
            }
            return;
        }
        
        // Filtrer et afficher les véhicules à vendre
        if (saleVehiclesContainer) {
            saleVehiclesContainer.innerHTML = '';
            const saleVehicles = vehicles.filter(v => v.type === 'sale');
            
            if (saleVehicles.length === 0) {
                saleVehiclesContainer.innerHTML = '<div class="card vehicle-card"><div class="vehicle-content" style="padding:20px;text-align:center;">Aucun véhicule à vendre disponible.</div></div>';
            } else {
                saleVehicles.slice(0, 3).forEach(vehicle => {
                    const card = createFrontendVehicleCard(vehicle);
                    saleVehiclesContainer.appendChild(card);
                });
            }
        }
        
        // Filtrer et afficher les véhicules à louer
        if (rentVehiclesContainer) {
            rentVehiclesContainer.innerHTML = '';
            const rentVehicles = vehicles.filter(v => v.type === 'rent');
            
            if (rentVehicles.length === 0) {
                rentVehiclesContainer.innerHTML = '<div class="card vehicle-card"><div class="vehicle-content" style="padding:20px;text-align:center;">Aucun véhicule à louer disponible.</div></div>';
            } else {
                rentVehicles.slice(0, 3).forEach(vehicle => {
                    const card = createFrontendVehicleCard(vehicle);
                    rentVehiclesContainer.appendChild(card);
                });
            }
        }
    }
    
    // Afficher les véhicules
    displayVehicles();
});
  </script>

</body>
</html>