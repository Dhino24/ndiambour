<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panneau d'Administration - Ndiambour Location</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <!-- Ajout des scripts Cloudinary -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-core/2.11.4/cloudinary-core-shrinkwrap.min.js"></script>
    
    <style>
        /* Variables et réinitialisation */
        :root {
            --primary-color: #1565C0; /* Bleu, couleur dominante du logo Ndiambour */
            --primary-dark: #0D47A1; /* Bleu foncé pour contrastes */
            --primary-light: #42A5F5; /* Bleu clair pour dégradés */
            --secondary-color: #FF9800; /* Orange pour accents */
            --secondary-dark: #F57C00; /* Orange foncé */
            --accent-color: #FF6F00; /* Orange vif pour mise en valeur */
            --light: #F5F5F5;
            --dark: #333333;
            --gray: #F0F2F5;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--gray);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: white;
            box-shadow: var(--shadow);
            padding: 20px 0;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .sidebar-logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu-item {
            margin-bottom: 5px;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--dark);
            border-left: 3px solid transparent;
            transition: var(--transition);
        }

        .sidebar-menu-link:hover,
        .sidebar-menu-link.active {
            background-color: rgba(21, 101, 192, 0.1);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .sidebar-menu-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .page-title {
            font-size: 1.8rem;
            color: var(--dark);
        }

        .user-dropdown {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .user-info {
            margin-right: 10px;
            text-align: right;
        }

        .user-name {
            font-weight: 600;
        }

        .user-role {
            font-size: 0.8rem;
            color: #777;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.8rem;
        }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: #777;
            font-size: 0.9rem;
        }

        /* Colored icons */
        .icon-blue {
            background-color: rgba(21, 101, 192, 0.1);
            color: var(--primary-color);
        }

        .icon-green {
            background-color: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
        }

        .icon-yellow {
            background-color: rgba(255, 152, 0, 0.1);
            color: var(--secondary-color);
        }

        .icon-red {
            background-color: rgba(255, 111, 0, 0.1);
            color: var(--accent-color);
        }

        /* Sections */
        .section {
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .section-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .section-content {
            padding: 20px;
        }

        /* Vehicle Management */
        .control-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background-color: var(--light);
            border-radius: 50px;
            padding: 8px 15px;
            max-width: 400px;
            flex-grow: 1;
        }

        .search-bar input {
            border: none;
            background-color: transparent;
            outline: none;
            padding: 5px 10px;
            width: 100%;
        }

        .search-bar i {
            color: #777;
        }

        .filter-bar {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-dropdown {
            position: relative;
        }

        .filter-btn {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn:hover {
            background-color: var(--light);
        }

        .filter-btn i {
            margin-left: 8px;
        }

        .add-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .add-btn:hover {
            background-color: var(--primary-dark);
        }

        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .vehicle-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .vehicle-card-header {
            position: relative;
        }

        .vehicle-img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .vehicle-status {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            background-color: white;
        }

        .status-sale {
            background-color: var(--primary-color);
            color: white;
        }

        .status-rent {
            background-color: var(--secondary-color);
            color: var(--dark);
        }

        .vehicle-card-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
            border: none;
        }

        .action-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .vehicle-card-body {
            padding: 15px;
        }

        .vehicle-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .vehicle-price {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .vehicle-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #777;
        }

        .vehicle-detail {
            display: flex;
            align-items: center;
        }

        .vehicle-detail i {
            margin-right: 5px;
        }

        /* Image Upload System */
        .upload-container {
            border: 2px dashed rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            background-color: var(--light);
            transition: var(--transition);
        }

        .upload-container:hover {
            border-color: var(--primary-color);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .upload-text {
            margin-bottom: 20px;
        }

        .upload-text h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .upload-text p {
            color: #777;
        }

        .upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        .upload-btn:hover {
            background-color: var(--primary-dark);
        }

        .file-input {
            display: none;
        }

        .uploaded-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .uploaded-image {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            height: 120px;
        }

        .uploaded-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-actions {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            opacity: 0;
            transition: var(--transition);
        }

        .uploaded-image:hover .image-actions {
            opacity: 1;
        }

        .image-action {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
            border: none;
        }

        .image-action:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            background-color: white;
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--accent-color);
        }

        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Styles pour la prévisualisation des photos */
        .photo-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .photo-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .preview-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-photo-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .photo-preview-item:hover .remove-photo-btn {
            opacity: 1;
        }

        /* Animation d'ajout de photos */
        @keyframes photoAppear {
            from { 
                opacity: 0; 
                transform: scale(0.8);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }

        .photo-preview-item {
            animation: photoAppear 0.3s ease;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                padding: 20px 0;
            }

            .sidebar-logo {
                padding: 0 10px 20px;
            }

            .sidebar-logo-text {
                display: none;
            }

            .sidebar-menu-link {
                padding: 15px;
                justify-content: center;
            }

            .sidebar-menu-link i {
                margin-right: 0;
                font-size: 1.2rem;
            }

            .sidebar-menu-link span {
                display: none;
            }

            .main-content {
                margin-left: 70px;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            }
        }

        @media (max-width: 576px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 15px;
            }

            .user-info {
                display: none;
            }

            .control-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-bar {
                max-width: 100%;
            }

            .filter-bar {
                justify-content: space-between;
            }
        }

        /* Style pour les onglets d'images */
        .tabs {
            display: flex;
            background-color: var(--light);
            border-radius: 5px;
            overflow: hidden;
        }

        .tab {
            padding: 10px 15px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            flex-grow: 1;
        }

        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tab-content {
            padding: 15px 0;
        }
        
        /* Toasts de notification */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: white;
            color: #333;
            border-radius: 5px;
            padding: 16px 20px;
            margin-bottom: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            overflow: hidden;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            margin-right: 12px;
            font-size: 1.4rem;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .toast-message {
            font-size: 0.9rem;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 1.1rem;
            color: #999;
            cursor: pointer;
            margin-left: 10px;
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: var(--primary-color);
            width: 100%;
            transform-origin: left;
            animation: progress 5s linear forwards;
        }

        .toast-success .toast-icon {
            color: #4CAF50;
        }

        .toast-error .toast-icon {
            color: #F44336;
        }

        .toast-info .toast-icon {
            color: var(--primary-color);
        }

        .toast-warning .toast-icon {
            color: #FF9800;
        }

        .toast-success .toast-progress {
            background: #4CAF50;
        }

        .toast-error .toast-progress {
            background: #F44336;
        }

        .toast-warning .toast-progress {
            background: #FF9800;
        }

        @keyframes progress {
            from { transform: scaleX(1); }
            to { transform: scaleX(0); }
        }
        
        /* Loader/spinner */
        .loader-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Checkbox personnalisé */
        .form-checkbox {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .form-checkbox input[type="checkbox"] {
            opacity: 0;
            position: absolute;
        }

        .form-checkbox label {
            position: relative;
            padding-left: 30px;
            cursor: pointer;
            display: inline-block;
            line-height: 20px;
        }

        .form-checkbox label:before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            background: #fff;
            border-radius: 3px;
            transition: var(--transition);
        }

        .form-checkbox input[type="checkbox"]:checked + label:before {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .form-checkbox input[type="checkbox"]:checked + label:after {
            content: '\f00c';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            left: 4px;
            top: 0px;
            color: white;
            font-size: 12px;
        }
        
        /* Styles pour les activités récentes */
        .activity-list {
            list-style: none;
        }
        
        .activity-item {
            display: flex;
            align-items: flex-start;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(21, 101, 192, 0.1);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .activity-desc {
            color: #777;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: #aaa;
        }
        
        /* Styles pour les réservations */
        .reservation-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .tab-btn {
            padding: 8px 15px;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .date-filter {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .date-input {
            padding: 8px 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }
        
        .view-toggle {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        
        .view-btn {
            padding: 8px 15px;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .view-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .view-content {
            display: none;
        }
        
        .view-content.active {
            display: block;
        }
        
        .reservations-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .reservations-table th,
        .reservations-table td {
            padding: 10px 15px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            text-align: left;
        }
        
        .reservations-table th {
            background-color: var(--light);
            font-weight: 600;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: inline-block;
        }
        
        .pending {
            background-color: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }
        
        .confirmed {
            background-color: rgba(33, 150, 243, 0.2);
            color: #2196F3;
        }
        
        .active {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        
        .completed {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        
        .cancelled {
            background-color: rgba(244, 67, 54, 0.2);
            color: #F44336;
        }
        
        .table-actions {
            display: flex;
            gap: 5px;
        }
        
        /* Styles pour le calendrier */
        .calendar-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-nav-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .calendar-nav-btn:hover {
            background-color: var(--light);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 10px;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 600;
            color: #777;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-auto-rows: minmax(60px, auto);
            gap: 5px;
        }
        
        .calendar-day {
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 5px;
            padding: 5px;
            position: relative;
            min-height: 60px;
        }
        
        .calendar-day.today {
            background-color: rgba(33, 150, 243, 0.1);
            border-color: #2196F3;
            font-weight: 600;
        }
        
        .calendar-day.other-month {
            opacity: 0.3;
        }
        
        .calendar-day.has-events::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--primary-color);
            bottom: 5px;
            right: 5px;
        }
        
        .calendar-legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }
        
        .legend-color.pending {
            background-color: #FF9800;
        }
        
        .legend-color.confirmed {
            background-color: #2196F3;
        }
        
        .legend-color.active {
            background-color: #4CAF50;
        }
        
        .legend-color.completed {
            background-color: #4CAF50;
        }
        
        /* Dropdown style */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            min-width: 150px;
            z-index: 10;
            display: none;
        }
        
        .dropdown-menu.active {
            display: block;
        }
        
        .dropdown-item {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: var(--dark);
            transition: var(--transition);
        }
        
        .dropdown-item:hover {
            background-color: var(--light);
        }
        
        .dropdown-item.active {
            background-color: rgba(21, 101, 192, 0.1);
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- Toasts container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <div class="sidebar-logo-text">Ndiambour</div>
        </div>
        <ul class="sidebar-menu">
            <li class="sidebar-menu-item">
                <a href="#dashboard" class="sidebar-menu-link active" data-section="dashboard-section">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Tableau de bord</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#vehicles" class="sidebar-menu-link" data-section="vehicles-section">
                    <i class="fas fa-car"></i>
                    <span>Véhicules</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#reservations" class="sidebar-menu-link" data-section="reservations-section">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Réservations</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#clients" class="sidebar-menu-link" data-section="clients-section">
                    <i class="fas fa-users"></i>
                    <span>Clients</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#statistics" class="sidebar-menu-link" data-section="statistics-section">
                    <i class="fas fa-chart-bar"></i>
                    <span>Statistiques</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#settings" class="sidebar-menu-link" data-section="settings-section">
                    <i class="fas fa-cog"></i>
                    <span>Paramètres</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="image-management.html" class="sidebar-menu-link">
                    <i class="fas fa-images"></i>
                    <span>Gestion des images</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="index.html" class="sidebar-menu-link">
                    <i class="fas fa-globe"></i>
                    <span>Voir le site</span>
                </a>
            </li>
            <li class="sidebar-menu-item">
                <a href="#logout" class="sidebar-menu-link" id="logout-link">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Déconnexion</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title" id="page-title">Tableau de bord</h1>
            <div class="user-dropdown" id="user-menu">
                <div class="user-info">
                    <div class="user-name" id="userName">Chargement...</div>
                    <div class="user-role" id="userRole">Administrateur</div>
                </div>
                <div class="user-avatar" id="userAvatar">...</div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="content-section active">
            <!-- Stats Cards -->
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-icon icon-blue">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-sale-count">0</h3>
                        <p>Véhicules en vente</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon-yellow">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-rent-count">0</h3>
                        <p>Véhicules en location</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon-green">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-reservations">0</h3>
                        <p>Réservations reçues</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon icon-red">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="stat-images">0</h3>
                        <p>Images gérées</p>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Activité récente</h2>
                </div>
                <div class="section-content">
                    <div id="activity-list-container">
                        <div class="loader-container">
                            <div class="loader"></div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Vehicles Section -->
        <div id="vehicles-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Gestion des véhicules</h2>
                    <button class="add-btn" id="openAddVehicleModal">
                        <i class="fas fa-plus"></i>
                        Ajouter un véhicule
                    </button>
                </div>
                <div class="section-content">
                    <div class="control-bar">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Rechercher un véhicule..." id="vehicle-search">
                        </div>
                        <div class="filter-bar">
                            <div class="filter-dropdown">
                                <button class="filter-btn" id="type-filter">
                                    Type <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu" id="type-dropdown">
                                    <a href="#all" class="dropdown-item active">Tous</a>
                                    <a href="#sale" class="dropdown-item">Vente</a>
                                    <a href="#rent" class="dropdown-item">Location</a>
                                </div>
                            </div>
                            <div class="filter-dropdown">
                                <button class="filter-btn" id="status-filter">
                                    Statut <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu" id="status-dropdown">
                                    <a href="#all" class="dropdown-item active">Tous</a>
                                    <a href="#available" class="dropdown-item">Disponible</a>
                                    <a href="#reserved" class="dropdown-item">Réservé</a>
                                    <a href="#sold" class="dropdown-item">Vendu</a>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <!-- Ce conteneur sera rempli dynamiquement -->
                    <div class="vehicles-grid">
                        <div class="loader-container">
                            <div class="loader"></div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Reservations Section -->
        <div id="reservations-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Gestion des réservations</h2>
                </div>
                <div class="section-content">
                    <!-- Reservation tabs -->
                    <div class="reservation-tabs">
                        <button class="tab-btn active" data-tab="all">Toutes</button>
                        <button class="tab-btn" data-tab="pending">En attente</button>
                        <button class="tab-btn" data-tab="confirmed">Confirmées</button>
                        <button class="tab-btn" data-tab="active">En cours</button>
                        <button class="tab-btn" data-tab="completed">Terminées</button>
                        <button class="tab-btn" data-tab="cancelled">Annulées</button>
                    </div>

                    <!-- Search and filter -->
                    <div class="control-bar">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Rechercher une réservation..." id="reservation-search">
                        </div>
                        <div class="filter-bar">
                            <div class="date-filter">
                                <input type="date" id="date-from" class="date-input" placeholder="Date début">
                                <span>à</span>
                                <input type="date" id="date-to" class="date-input" placeholder="Date fin">
                                <button class="filter-btn" id="apply-date-filter">Appliquer</button>
                            </div>
                        </div>
                    </div>

                    <!-- Toggle between list and calendar views -->
                    <div class="view-toggle">
                        <button class="view-btn active" id="list-view-btn"><i class="fas fa-list"></i> Liste</button>
                        <button class="view-btn" id="calendar-view-btn"><i class="fas fa-calendar-alt"></i> Calendrier</button>
                    </div>

                    <!-- List view -->
                    <div id="list-view" class="view-content active">
                        <div class="reservations-table-container">
                            <div id="reservations-table-container">
                                <div class="loader-container">
                                    <div class="loader"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Calendar view -->
                    <div id="calendar-view" class="view-content">
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <button class="calendar-nav-btn" id="prev-month"><i class="fas fa-chevron-left"></i></button>
                                <h3 id="calendar-title">Mars 2025</h3>
                                <button class="calendar-nav-btn" id="next-month"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-grid">
                                <div class="calendar-weekdays">
                                    <div>Lun</div>
                                    <div>Mar</div>
                                    <div>Mer</div>
                                    <div>Jeu</div>
                                    <div>Ven</div>
                                    <div>Sam</div>
                                    <div>Dim</div>
                                </div>
                                <div class="calendar-days">
                                    <!-- Jours générés par JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="calendar-legend">
                            <div class="legend-item">
                                <div class="legend-color pending"></div>
                                <div>En attente</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color confirmed"></div>
                                <div>Confirmée</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color active"></div>
                                <div>En cours</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color completed"></div>
                                <div>Terminée</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <!-- Clients Section -->
        <div id="clients-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Gestion des clients</h2>
                </div>
                <div class="section-content">
                    <p>Cette fonctionnalité sera disponible prochainement...</p>
                </div>
            </section>
        </div>
        
        <!-- Stats Section -->
        <div id="statistics-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Statistiques</h2>
                </div>
                <div class="section-content">
                    <p>Les graphiques et analyses seront disponibles prochainement...</p>
                </div>
            </section>
        </div>
        
        <!-- Settings Section -->
        <div id="settings-section" class="content-section">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">Paramètres du site</h2>
                </div>
                <div class="section-content">
                    <form id="settings-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="siteName" class="form-label">Nom du site</label>
                                <input type="text" id="siteName" class="form-control" placeholder="Ex: Ndiambour Location">
                            </div>
                            <div class="form-group">
                                <label for="currency" class="form-label">Devise</label>
                                <input type="text" id="currency" class="form-control" placeholder="Ex: FCFA">
                            </div>
                            <div class="form-group">
                                <label for="language" class="form-label">Langue principale</label>
                                <select id="language" class="form-select">
                                    <option value="fr">Français</option>
                                    <option value="en">Anglais</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="contactEmail" class="form-label">Email de contact</label>
                                <input type="email" id="contactEmail" class="form-control" placeholder="Ex: contact@ndiambourlocation.com">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Options d'affichage</label>
                            <div class="form-checkbox">
                                <input type="checkbox" id="showAvailabilityOnSite" checked>
                                <label for="showAvailabilityOnSite">Afficher la disponibilité des véhicules sur le site</label>
                            </div>
                            <div class="form-checkbox">
                                <input type="checkbox" id="enableOnlineReservation" checked>
                                <label for="enableOnlineReservation">Activer les réservations en ligne</label>
                            </div>
                            <div class="form-checkbox">
                                <input type="checkbox" id="enablePriceDisplay" checked>
                                <label for="enablePriceDisplay">Afficher les prix des véhicules</label>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="resetSettings" class="btn btn-secondary">Réinitialiser</button>
                            <button type="submit" class="btn btn-primary">Enregistrer les paramètres</button>
                        </div>
                    </form>
                </div>
            </section>
        </div>
    </main>

    <!-- Add Vehicle Modal -->
    <div class="modal" id="addVehicleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Ajouter un nouveau véhicule</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addVehicleForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="vehicleType" class="form-label">Type de service</label>
                            <select id="vehicleType" class="form-select">
                                <option value="sale">Vente</option>
                                <option value="rent">Location</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleMake" class="form-label">Marque</label>
                            <input type="text" id="vehicleMake" class="form-control" placeholder="Ex: Toyota">
                        </div>
                        <div class="form-group">
                            <label for="vehicleModel" class="form-label">Modèle</label>
                            <input type="text" id="vehicleModel" class="form-control" placeholder="Ex: RAV4">
                        </div>
                        <div class="form-group">
                            <label for="vehicleYear" class="form-label">Année</label>
                            <input type="number" id="vehicleYear" class="form-control" placeholder="Ex: 2023">
                        </div>
                        <div class="form-group">
                            <label for="vehiclePrice" class="form-label">Prix</label>
                            <input type="number" id="vehiclePrice" class="form-control" placeholder="En FCFA">
                        </div>
                        <div class="form-group">
                            <label for="vehicleMileage" class="form-label">Kilométrage</label>
                            <input type="number" id="vehicleMileage" class="form-control" placeholder="En km">
                        </div>
                        <div class="form-group">
                            <label for="vehicleFuel" class="form-label">Carburant</label>
                            <select id="vehicleFuel" class="form-select">
                                <option value="essence">Essence</option>
                                <option value="diesel">Diesel</option>
                                <option value="hybrid">Hybride</option>
                                <option value="electric">Électrique</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleTransmission" class="form-label">Transmission</label>
                            <select id="vehicleTransmission" class="form-select">
                                <option value="manual">Manuelle</option>
                                <option value="auto">Automatique</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="vehicleDescription" class="form-label">Description</label>
                        <textarea id="vehicleDescription" class="form-control" rows="4" placeholder="Description détaillée du véhicule..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Photos</label>
                        <div class="tabs" style="margin-bottom: 15px;">
                            <div class="tab active" data-image-tab="upload">Télécharger des photos</div>
                            <div class="tab" data-image-tab="select">Sélectionner des images existantes</div>
                        </div>
                        
                        <!-- Tab content: Upload -->
                        <div class="tab-content active" id="upload-tab-content">
                            <div class="upload-container" style="padding: 15px;">
                                <div class="upload-icon" style="font-size: 2rem; margin-bottom: 10px;">
                                    <i class="fas fa-image"></i>
                                </div>
                                <p style="margin-bottom: 10px; font-size: 0.9rem;">Ajoutez des photos pour montrer votre véhicule</p>
                                <button class="upload-btn" id="vehiclePhotoUploadBtn" type="button" style="font-size: 0.9rem; padding: 8px 15px;">
                                    <i class="fas fa-plus"></i> Ajouter des photos
                                </button>
                                <!-- Ajout de l'élément input manquant -->
                                <input type="file" id="vehiclePhotoInput" multiple accept="image/*" style="display: none;">
                                <div id="photoCounter" style="margin-top: 10px; font-size: 0.8rem; color: #777;">0 photo sélectionnée</div>
                            </div>
                            
                            <!-- Zone de prévisualisation des photos -->
                            <div id="vehiclePhotoPreview" class="photo-preview-container" style="display: none;"></div>
                        </div>
                        
                        <!-- Tab content: Select -->
                        <div class="tab-content" id="select-tab-content" style="display: none;">
                            <div class="search-bar" style="margin-bottom: 15px;">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Rechercher une image..." id="image-search">
                            </div>
                            
                            <div id="available-images-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; max-height: 300px; overflow-y: auto;">
                                <div class="loader-container">
                                    <div class="loader"></div>
                                </div>
                            </div>
                            
                            <div id="selected-images-container" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                                <h4 style="margin-bottom: 10px; font-size: 1rem;">Images sélectionnées pour ce véhicule</h4>
                                <div id="selected-images" style="display: flex; flex-wrap: wrap; gap: 10px;">
                                    <!-- Les images sélectionnées seront affichées ici -->
                                    <div class="empty-selection" style="width: 100%; text-align: center; padding: 15px; color: #777; font-style: italic;">
                                        Aucune image sélectionnée
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddVehicle">Annuler</button>
                <button class="btn btn-primary" id="saveVehicle">Enregistrer</button>
            </div>
        </div>
    </div>
</body>
<!-- Ajouter ce contenu à la fin du fichier -->
<script>
    // Script pour le panneau d'administration - Avec intégration Cloudinary

// Configuration Cloudinary
const cloudinaryConfig = {
    cloudName: 'diovja6qr', // Remplacer par votre nom de cloud
    uploadPreset: 'ndiambour', // Preset créé dans votre compte Cloudinary
    folder: 'ndiambour' // Dossier dans lequel stocker les images
};

// Service Cloudinary pour gérer les interactions avec l'API
const CloudinaryService = {
    // Obtenir les options de base pour le widget d'upload
    getDefaultUploadOptions() {
        return {
            cloudName: cloudinaryConfig.cloudName,
            uploadPreset: cloudinaryConfig.uploadPreset,
            folder: cloudinaryConfig.folder,
            multiple: true,
            maxFiles: 10,
            sources: ['local', 'url', 'camera'],
            resourceType: 'image',
            clientAllowedFormats: ['jpg', 'jpeg', 'png', 'webp'],
            maxFileSize: 5000000, // 5MB
            styles: {
                palette: {
                    window: "#FFFFFF",
                    sourceBg: "#F0F2F5",
                    windowBorder: "#90A0B3",
                    tabIcon: "#1565C0",
                    inactiveTabIcon: "#69778A",
                    menuIcons: "#1565C0",
                    link: "#0078FF",
                    action: "#1565C0",
                    inProgress: "#0078FF",
                    complete: "#20B832",
                    error: "#FF3030",
                    textDark: "#000000",
                    textLight: "#FFFFFF"
                }
            },
            language: 'fr',
            text: {
                'fr': {
                    'local': {
                        'browse': 'Parcourir',
                        'dd_title_single': 'Glissez-déposez une image',
                        'dd_title_multi': 'Glissez-déposez des images',
                        'drop_title_single': 'Déposez une image',
                        'drop_title_multiple': 'Déposez des images'
                    }
                }
            }
        };
    },
    
    // Ouvrir le widget d'upload Cloudinary
    openUploadWidget(options = {}, callback) {
        if (typeof cloudinary === 'undefined') {
            console.error("Cloudinary n'est pas disponible. Vérifiez que les scripts sont bien chargés.");
            ToastManager.error("Erreur", "L'outil d'upload d'images n'est pas disponible.");
            return;
        }
        
        // Fusionner les options par défaut avec les options personnalisées
        const uploadOptions = { ...this.getDefaultUploadOptions(), ...options };
        
        // Ouvrir le widget
        cloudinary.openUploadWidget(uploadOptions, callback);
    },
    
    // Obtenir une URL optimisée
    getOptimizedUrl(url, width = 300, height = 200) {
        if (!url || !url.includes('cloudinary.com')) return url;
        
        // Remplacer le téléchargement par une transformation
        return url.replace('/upload/', `/upload/c_fill,g_auto,h_${height},w_${width}/`);
    },
    
    // Obtenir une miniature
    getThumbnailUrl(url, width = 100, height = 100) {
        if (!url || !url.includes('cloudinary.com')) return url;
        
        return url.replace('/upload/', `/upload/c_thumb,g_face,h_${height},w_${width}/`);
    }
};

// Système de notification (toasts)
const ToastManager = {
    container: document.getElementById('toast-container'),
    
    show: function(type, title, message, duration = 5000) {
        // Créer le toast
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        
        // Icon based on type
        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        if (type === 'error') icon = 'exclamation-circle';
        if (type === 'warning') icon = 'exclamation-triangle';
        
        toast.innerHTML = `
            <div class="toast-icon"><i class="fas fa-${icon}"></i></div>
            <div class="toast-content">
                <div class="toast-title">${title}</div>
                <div class="toast-message">${message}</div>
            </div>
            <button class="toast-close">&times;</button>
            <div class="toast-progress"></div>
        `;
        
        // Ajouter au container
        this.container.appendChild(toast);
        
        // Animation d'entrée
        setTimeout(() => {
            toast.classList.add('show');
        }, 10);
        
        // Configurer le bouton de fermeture
        const closeBtn = toast.querySelector('.toast-close');
        closeBtn.addEventListener('click', () => {
            toast.classList.remove('show');
            setTimeout(() => {
                toast.remove();
            }, 300);
        });
        
        // Auto-dismiss après la durée spécifiée
        setTimeout(() => {
            if (toast.parentNode) {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }
        }, duration);
        
        return toast;
    },
    
    success: function(title, message, duration) {
        return this.show('success', title, message, duration);
    },
    
    error: function(title, message, duration) {
        return this.show('error', title, message, duration);
    },
    
    info: function(title, message, duration) {
        return this.show('info', title, message, duration);
    },
    
    warning: function(title, message, duration) {
        return this.show('warning', title, message, duration);
    }
};

// Service de données simplifié (fallback si Firebase n'est pas disponible)
const LocalDataService = {
    // Clés de stockage localStorage
    STORAGE_KEYS: {
        VEHICLES: 'autosenegal_vehicles',
        IMAGES: 'autosenegal_images',
        CATEGORIES: 'autosenegal_categories',
        SETTINGS: 'autosenegal_settings',
        RESERVATIONS: 'autosenegal_reservations',
        CONTACTS: 'autosenegal_contacts'
    },
    
    // Récupérer des données du localStorage
    getStorageData: function(key, defaultValue = []) {
        try {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : defaultValue;
        } catch (error) {
            console.error(`Erreur lors de la récupération des données de ${key}:`, error);
            return defaultValue;
        }
    },
    
    // Sauvegarder des données dans localStorage
    setStorageData: function(key, data) {
        try {
            localStorage.setItem(key, JSON.stringify(data));
            return true;
        } catch (error) {
            console.error(`Erreur lors de la sauvegarde des données dans ${key}:`, error);
            return false;
        }
    },
    
    // Obtenir tous les véhicules
    getAllVehicles: function() {
        return this.getStorageData(this.STORAGE_KEYS.VEHICLES);
    },
    
    // Obtenir les véhicules par type
    getVehiclesByType: function(type) {
        const vehicles = this.getAllVehicles();
        return vehicles.filter(v => v.type === type);
    },
    
    // Obtenir un véhicule par ID
    getVehicleById: function(id) {
        const vehicles = this.getAllVehicles();
        return vehicles.find(v => v.id === id);
    },
    
    // Ajouter un véhicule
    addVehicle: function(vehicleData) {
        const vehicles = this.getAllVehicles();
        
        // Générer un ID si non fourni
        if (!vehicleData.id) {
            vehicleData.id = 'vehicle-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
        }
        
        // Ajouter le véhicule
        vehicles.push(vehicleData);
        this.setStorageData(this.STORAGE_KEYS.VEHICLES, vehicles);
        
        return vehicleData;
    },
    
    // Mettre à jour un véhicule
    updateVehicle: function(id, updates) {
        const vehicles = this.getAllVehicles();
        const index = vehicles.findIndex(v => v.id === id);
        
        if (index !== -1) {
            vehicles[index] = { ...vehicles[index], ...updates };
            this.setStorageData(this.STORAGE_KEYS.VEHICLES, vehicles);
            return vehicles[index];
        }
        
        return null;
    },
    
    // Supprimer un véhicule
    deleteVehicle: function(id) {
        const vehicles = this.getAllVehicles();
        const updatedVehicles = vehicles.filter(v => v.id !== id);
        
        if (updatedVehicles.length < vehicles.length) {
            this.setStorageData(this.STORAGE_KEYS.VEHICLES, updatedVehicles);
            return true;
        }
        
        return false;
    },
    
    // Obtenir toutes les images
    getAllImages: function() {
        return this.getStorageData(this.STORAGE_KEYS.IMAGES);
    },
    
    // Obtenir une image par ID
    getImageById: function(id) {
        const images = this.getAllImages();
        return images.find(img => img.id === id);
    },
    
    // Obtenir les images pour un véhicule
    getImagesForVehicle: function(vehicleId) {
        const images = this.getAllImages();
        return images.filter(img => img.vehicleId === vehicleId);
    },
    
    // Ajouter une image (avec support Cloudinary)
    addImage: function(imageData) {
        const images = this.getAllImages();
        
        // Générer un ID si non fourni
        if (!imageData.id) {
            imageData.id = 'img-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
        }
        
        // Vérifier si c'est une image Cloudinary et ajouter des métadonnées spécifiques
        if (imageData.src && imageData.src.includes('cloudinary.com')) {
            // Extraire le public_id si non fourni
            if (!imageData.publicId && imageData.src) {
                try {
                    // Format typique: https://res.cloudinary.com/cloudName/image/upload/v1234567890/folder/publicId.ext
                    const urlParts = imageData.src.split('/upload/');
                    if (urlParts.length > 1) {
                        const pathParts = urlParts[1].split('/');
                        if (pathParts.length > 1) {
                            // Supprimer les paramètres de transformation et l'extension
                            const publicIdWithExt = pathParts[pathParts.length - 1];
                            imageData.publicId = publicIdWithExt.split('.')[0];
                        }
                    }
                } catch (error) {
                    console.warn("Impossible d'extraire le public_id de l'URL Cloudinary", error);
                }
            }
            
            // Ajouter un indicateur pour savoir que c'est une image Cloudinary
            imageData.isCloudinary = true;
        }
        
        // Ajouter la date si non fournie
        if (!imageData.dateAdded) {
            imageData.dateAdded = new Date().toISOString();
        }
        
        // Ajouter à la collection
        images.push(imageData);
        this.setStorageData(this.STORAGE_KEYS.IMAGES, images);
        
        // Si l'image est associée à un véhicule, mettre à jour le véhicule
        if (imageData.vehicleId) {
            this.addImageToVehicle(imageData.id, imageData.vehicleId);
        }
        
        return imageData;
    },
    
    // Mettre à jour une image
    updateImage: function(id, updates) {
        const images = this.getAllImages();
        const index = images.findIndex(img => img.id === id);
        
        if (index !== -1) {
            images[index] = { ...images[index], ...updates };
            this.setStorageData(this.STORAGE_KEYS.IMAGES, images);
            
            // Si le vehicleId a changé, mettre à jour les associations
            if (updates.vehicleId !== undefined && updates.vehicleId !== images[index].vehicleId) {
                // Si l'ancienne valeur existe, retirer l'image du véhicule
                if (images[index].vehicleId) {
                    this.removeImageFromVehicle(id, images[index].vehicleId);
                }
                
                // Si la nouvelle valeur existe, ajouter l'image au véhicule
                if (updates.vehicleId) {
                    this.addImageToVehicle(id, updates.vehicleId);
                }
            }
            
            return images[index];
        }
        
        return null;
    },
    
    // Supprimer une image
    deleteImage: function(id) {
        const images = this.getAllImages();
        const imageIndex = images.findIndex(img => img.id === id);
        
        if (imageIndex === -1) return false;
        
        const image = images[imageIndex];
        
        // Si l'image est associée à un véhicule, mettre à jour le véhicule
        if (image.vehicleId) {
            this.removeImageFromVehicle(id, image.vehicleId);
        }
        
        // Supprimer l'image de la collection
        images.splice(imageIndex, 1);
        this.setStorageData(this.STORAGE_KEYS.IMAGES, images);
        
        return true;
    },
    
    // Ajouter une image à un véhicule
    addImageToVehicle: function(imageId, vehicleId) {
        const vehicles = this.getAllVehicles();
        const vehicleIndex = vehicles.findIndex(v => v.id === vehicleId);
        
        if (vehicleIndex === -1) return false;
        
        // S'assurer que le véhicule a un tableau d'images
        if (!vehicles[vehicleIndex].images) {
            vehicles[vehicleIndex].images = [];
        }
        
        // Ajouter l'ID d'image s'il n'est pas déjà présent
        if (!vehicles[vehicleIndex].images.includes(imageId)) {
            vehicles[vehicleIndex].images.push(imageId);
            this.setStorageData(this.STORAGE_KEYS.VEHICLES, vehicles);
            
            // Mettre à jour l'image avec le vehicleId
            this.updateImage(imageId, { vehicleId });
        }
        
        return true;
    },
    
    // Supprimer une image d'un véhicule
    removeImageFromVehicle: function(imageId, vehicleId) {
        const vehicles = this.getAllVehicles();
        const vehicleIndex = vehicles.findIndex(v => v.id === vehicleId);
        
        if (vehicleIndex === -1 || !vehicles[vehicleIndex].images) return false;
        
        // Retirer l'ID d'image du tableau
        const imageIndex = vehicles[vehicleIndex].images.indexOf(imageId);
        if (imageIndex !== -1) {
            vehicles[vehicleIndex].images.splice(imageIndex, 1);
            this.setStorageData(this.STORAGE_KEYS.VEHICLES, vehicles);
            
            // Mettre à jour l'image pour enlever l'association
            this.updateImage(imageId, { vehicleId: null });
        }
        
        return true;
    },
    
    // Fonctions de réservation
    getReservations: function() {
        return this.getStorageData(this.STORAGE_KEYS.RESERVATIONS);
    },
    
    // Ajouter une réservation
    addReservation: function(reservationData) {
        const reservations = this.getReservations();
        
        // Générer un ID si non fourni
        if (!reservationData.id) {
            reservationData.id = 'res-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
        }
        
        // Ajouter une date de création si non fournie
        if (!reservationData.dateCreated) {
            reservationData.dateCreated = new Date().toISOString();
        }
        
        // Définir un statut par défaut si non fourni
        if (!reservationData.status) {
            reservationData.status = 'pending';
        }
        
        // Ajouter la réservation
        reservations.push(reservationData);
        this.setStorageData(this.STORAGE_KEYS.RESERVATIONS, reservations);
        
        return reservationData;
    },
    
    // Fonctions de messages de contact
    getContacts: function() {
        return this.getStorageData(this.STORAGE_KEYS.CONTACTS);
    },
    
    // Ajouter un message de contact
    addContactMessage: function(messageData) {
        const contacts = this.getContacts();
        
        // Générer un ID si non fourni
        if (!messageData.id) {
            messageData.id = 'msg-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
        }
        
        // Ajouter une date de création si non fournie
        if (!messageData.dateCreated) {
            messageData.dateCreated = new Date().toISOString();
        }
        
        // Ajouter le message
        contacts.push(messageData);
        this.setStorageData(this.STORAGE_KEYS.CONTACTS, contacts);
        
        return messageData;
    },
    
    // Fonctions de paramètres
    getSettings: function() {
        return this.getStorageData(this.STORAGE_KEYS.SETTINGS, {
            siteName: 'Ndiambour Location',
            currency: 'FCFA',
            language: 'fr',
            contactEmail: 'contact@ndiambourlocation.com',
            showAvailabilityOnSite: true,
            enableOnlineReservation: true,
            enablePriceDisplay: true
        });
    },
    
    updateSettings: function(settings) {
        return this.setStorageData(this.STORAGE_KEYS.SETTINGS, settings);
    }
};

// AdminManager - Gère toutes les fonctionnalités
const AdminManager = {
    // État de l'application
    state: {
        currentSection: 'dashboard-section',
        vehicles: [],
        reservations: [],
        images: [],
        photoCount: 0,
        cloudinaryImages: [] // Pour stocker les images uploadées via Cloudinary
    },
    
    // Initialisation
    init: function() {
        // Configurer la navigation
        this.setupNavigation();
        
        // Initialiser le dashboard
        this.updateDashboardStats();
        
        // Initialiser les sections
        this.initVehiclesSection();
        this.initReservationsSection();
        this.initSettingsSection();
        
        // Configuration des modals et formulaires
        this.setupModals();
        
        console.log("AdminManager initialisé avec succès");
        ToastManager.info("Prêt", "Le panneau d'administration est prêt à l'utilisation");
    },
    
    // Configuration de la navigation
    setupNavigation: function() {
        // Afficher la section active
        const showSection = (sectionId) => {
            // Masquer toutes les sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Afficher la section demandée
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                this.state.currentSection = sectionId;
                
                // Mise à jour du titre de la page
                const sidebarLink = document.querySelector(`.sidebar-menu-link[data-section="${sectionId}"]`);
                if (sidebarLink) {
                    const pageTitle = document.getElementById('page-title');
                    if (pageTitle) {
                        pageTitle.textContent = sidebarLink.querySelector('span').textContent;
                    }
                }
                
                // Charger les données spécifiques à la section si nécessaire
                if (sectionId === 'vehicles-section') {
                    this.loadVehicles();
                } else if (sectionId === 'reservations-section') {
                    this.loadReservations();
                } else if (sectionId === 'settings-section') {
                    this.loadSettings();
                }
            }
        };
        
        // Configurer les liens de la sidebar
        document.querySelectorAll('.sidebar-menu-link').forEach(link => {
            link.addEventListener('click', (e) => {
                // Ne pas interférer avec les liens externes
                if (!link.getAttribute('data-section')) return;
                
                e.preventDefault();
                
                // Déselectionner tous les liens
                document.querySelectorAll('.sidebar-menu-link').forEach(l => {
                    l.classList.remove('active');
                });
                
                // Sélectionner le lien actif
                link.classList.add('active');
                
                // Afficher la section correspondante
                const sectionId = link.getAttribute('data-section');
                showSection(sectionId);
            });
        });
        
        // Gestion du lien de déconnexion
        document.getElementById('logout-link').addEventListener('click', (e) => {
            e.preventDefault();
            if (confirm('Êtes-vous sûr de vouloir vous déconnecter?')) {
                // Rediriger vers la page de connexion
                window.location.href = 'admin-login.html';
            }
        });
    },
    
    // Mise à jour des statistiques du tableau de bord
    updateDashboardStats: function() {
        try {
            // Récupérer les données
            const vehicles = LocalDataService.getAllVehicles();
            const saleVehicles = vehicles.filter(v => v.type === 'sale');
            const rentVehicles = vehicles.filter(v => v.type === 'rent');
            const reservations = LocalDataService.getReservations();
            const images = LocalDataService.getAllImages();
            
            // Mettre à jour l'affichage
            document.getElementById('stat-sale-count').textContent = saleVehicles.length;
            document.getElementById('stat-rent-count').textContent = rentVehicles.length;
            document.getElementById('stat-reservations').textContent = reservations.length;
            document.getElementById('stat-images').textContent = images.length;
            
            // Générer l'activité récente
            this.generateRecentActivity();
        } catch (error) {
            console.error("Erreur lors de la mise à jour des statistiques:", error);
        }
    },
    
    // Générer l'activité récente
    generateRecentActivity: function() {
        const container = document.getElementById('activity-list-container');
        if (!container) return;
        
        try {
            // Récupérer les réservations et contacts
            const reservations = LocalDataService.getReservations();
            const contacts = LocalDataService.getContacts();
            
            // Combiner en une seule liste d'activités
            const activities = [
                ...reservations.map(r => ({
                    type: 'reservation',
                    date: new Date(r.dateCreated || Date.now()),
                    title: 'Nouvelle réservation',
                    description: `${r.fullName || 'Client'} a réservé ${r.vehicle || 'un véhicule'}`,
                    icon: 'fa-calendar-alt'
                })),
                ...contacts.map(c => ({
                    type: 'contact',
                    date: new Date(c.dateCreated || Date.now()),
                    title: 'Nouveau message',
                    description: `${c.fullName || 'Client'} a envoyé un message: "${c.subject || 'Sans objet'}"`,
                    icon: 'fa-envelope'
                }))
            ];
            
            // Trier par date (plus récent en premier)
            activities.sort((a, b) => b.date - a.date);
            
            // Limiter à 5 activités
            const recentActivities = activities.slice(0, 5);
            
            // Générer le HTML
            let html = '';
            
            if (recentActivities.length === 0) {
                html = `
                    <div style="text-align: center; padding: 20px; color: #777;">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Aucune activité récente</p>
                    </div>
                `;
            } else {
                html = '<ul class="activity-list">';
                
                recentActivities.forEach(activity => {
                    const formattedDate = activity.date.toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'short',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    html += `
                        <li class="activity-item">
                            <div class="activity-icon"><i class="fas ${activity.icon}"></i></div>
                            <div class="activity-content">
                                <div class="activity-title">${activity.title}</div>
                                <div class="activity-desc">${activity.description}</div>
                                <div class="activity-time">${formattedDate}</div>
                            </div>
                        </li>
                    `;
                });
                
                html += '</ul>';
            }
            
            // Mettre à jour le conteneur
            container.innerHTML = html;
            
        } catch (error) {
            console.error("Erreur lors de la génération de l'activité récente:", error);
            container.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #777;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <p>Erreur lors du chargement des activités</p>
                </div>
            `;
        }
    },
    
    // Initialisation de la section véhicules
    initVehiclesSection: function() {
        // Configuration de la recherche
        const searchInput = document.getElementById('vehicle-search');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.filterVehicles(e.target.value);
            });
        }
        
        // Configuration des filtres de type
        document.querySelectorAll('#type-dropdown .dropdown-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Mettre à jour la sélection active
                document.querySelectorAll('#type-dropdown .dropdown-item').forEach(i => {
                    i.classList.remove('active');
                });
                item.classList.add('active');
                
                // Filtrer par type
                const type = item.getAttribute('href').substring(1); // enlever le #
                this.filterVehiclesByType(type);
                
                // Fermer le dropdown
                document.getElementById('type-dropdown').classList.remove('active');
            });
        });
        
        // Toggle pour le dropdown
        document.getElementById('type-filter').addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('type-dropdown').classList.toggle('active');
            document.getElementById('status-dropdown').classList.remove('active');
        });
        
        // Configuration du filtre de statut
        document.querySelectorAll('#status-dropdown .dropdown-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Mettre à jour la sélection active
                document.querySelectorAll('#status-dropdown .dropdown-item').forEach(i => {
                    i.classList.remove('active');
                });
                item.classList.add('active');
                
                // Filtrer par statut
                const status = item.getAttribute('href').substring(1); // enlever le #
                this.filterVehiclesByStatus(status);
                
                // Fermer le dropdown
                document.getElementById('status-dropdown').classList.remove('active');
            });
        });
        
        // Toggle pour le dropdown
        document.getElementById('status-filter').addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('status-dropdown').classList.toggle('active');
            document.getElementById('type-dropdown').classList.remove('active');
        });
        
        // Clic en dehors des dropdowns pour les fermer
        document.addEventListener('click', () => {
            document.getElementById('type-dropdown').classList.remove('active');
            document.getElementById('status-dropdown').classList.remove('active');
        });
        
        // Configurer le bouton d'ajout
        document.getElementById('openAddVehicleModal').addEventListener('click', () => {
            // Réinitialiser le formulaire
            document.getElementById('addVehicleForm').reset();
            
            // Réinitialiser l'état des images Cloudinary
            this.state.cloudinaryImages = [];
            
            // Réinitialiser la prévisualisation des photos
            const photoPreview = document.getElementById('vehiclePhotoPreview');
            if (photoPreview) {
                photoPreview.innerHTML = '';
                photoPreview.style.display = 'none';
            }
            
            // Réinitialiser le compteur de photos
            const photoCounter = document.getElementById('photoCounter');
            if (photoCounter) {
                photoCounter.textContent = '0 photo sélectionnée';
            }
            
            // Changer le titre
            document.querySelector('#addVehicleModal .modal-title').textContent = 'Ajouter un nouveau véhicule';
            
            // Configurer le bouton de sauvegarde
            const saveBtn = document.getElementById('saveVehicle');
            saveBtn.setAttribute('data-mode', 'add');
            saveBtn.removeAttribute('data-id');
            
            // Afficher le modal
            document.getElementById('addVehicleModal').classList.add('active');
        });
    },
    
    // Chargement des véhicules
    loadVehicles: function() {
        const container = document.querySelector('.vehicles-grid');
        if (!container) return;
        
        try {
            // Récupérer tous les véhicules
            const vehicles = LocalDataService.getAllVehicles();
            this.state.vehicles = vehicles;
            
            // Générer l'affichage
            this.renderVehicles(vehicles);
        } catch (error) {
            console.error("Erreur lors du chargement des véhicules:", error);
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 30px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #f44336; margin-bottom: 15px;"></i>
                    <p>Erreur lors du chargement des véhicules</p>
                </div>
            `;
        }
    },
    
    // Rendu des véhicules
    renderVehicles: function(vehicles) {
        const container = document.querySelector('.vehicles-grid');
        if (!container) return;
        
        // Vider le conteneur
        container.innerHTML = '';
        
        if (vehicles.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 30px;">
                    <i class="fas fa-car" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                    <p>Aucun véhicule trouvé</p>
                    <p>Utilisez le bouton "Ajouter un véhicule" pour commencer</p>
                </div>
            `;
            return;
        }
        
        // Générer les cartes de véhicules
        vehicles.forEach(vehicle => {
            const card = this.createVehicleCard(vehicle);
            container.appendChild(card);
        });
    },
    
    // Création d'une carte de véhicule
    createVehicleCard: function(vehicle) {
        const card = document.createElement('div');
        card.className = 'vehicle-card';
        card.setAttribute('data-id', vehicle.id);
        card.setAttribute('data-type', vehicle.type || 'sale');
        card.setAttribute('data-status', vehicle.status || 'available');
        
        // Rechercher l'image principale
        let imageSrc = '/api/placeholder/300/150';
        let firstImage = null;
        
        if (vehicle.images && vehicle.images.length > 0) {
            firstImage = LocalDataService.getImageById(vehicle.images[0]);
            if (firstImage && firstImage.src) {
                // Vérifier si c'est une image Cloudinary et optimiser
                imageSrc = firstImage.src.includes('cloudinary.com') 
                    ? CloudinaryService.getOptimizedUrl(firstImage.src, 300, 150) 
                    : firstImage.src;
            }
        }
        
        // Formatter le prix
        const priceValue = parseFloat(vehicle.price) || 0;
        const formattedPrice = vehicle.type === 'rent' 
            ? `${priceValue.toLocaleString()} FCFA / jour` 
            : `${priceValue.toLocaleString()} FCFA`;
        
        // Générer les détails selon le type
        let details = '';
        
        if (vehicle.type === 'sale') {
            details = `
                <span class="vehicle-detail"><i class="fas fa-tachometer-alt"></i> ${vehicle.mileage || '0'} km</span>
                <span class="vehicle-detail"><i class="fas fa-gas-pump"></i> ${vehicle.fuel || 'Non spécifié'}</span>
                <span class="vehicle-detail"><i class="fas fa-cog"></i> ${vehicle.transmission || 'Auto'}</span>
            `;
        } else {
            details = `
                <span class="vehicle-detail"><i class="fas fa-user"></i> ${vehicle.seats || '5'} places</span>
                <span class="vehicle-detail"><i class="fas fa-suitcase"></i> ${vehicle.baggage || '4'} bags</span>
                <span class="vehicle-detail"><i class="fas fa-snowflake"></i> Clim</span>
            `;
        }
        
        // Créer le HTML de la carte
        card.innerHTML = `
            <div class="vehicle-card-header">
                <img src="${imageSrc}" alt="${vehicle.make} ${vehicle.model}" class="vehicle-img" onerror="this.src='/api/placeholder/300/150';">
                <div class="vehicle-status ${vehicle.type === 'rent' ? 'status-rent' : 'status-sale'}">
                    ${vehicle.type === 'rent' ? 'Location' : 'Vente'}
                </div>
                <div class="vehicle-card-actions">
                    <button class="action-btn edit-vehicle" title="Modifier" data-id="${vehicle.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-vehicle" title="Supprimer" data-id="${vehicle.id}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
            <div class="vehicle-card-body">
                <h3 class="vehicle-title">${vehicle.make} ${vehicle.model} ${vehicle.year || ''}</h3>
                <div class="vehicle-price">${formattedPrice}</div>
                <div class="vehicle-details">
                    ${details}
                </div>
            </div>
        `;
        
        // Configurer les événements des boutons d'action
        const editBtn = card.querySelector('.edit-vehicle');
        const deleteBtn = card.querySelector('.delete-vehicle');
        
        editBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            this.editVehicle(vehicle.id);
        });
        
        deleteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            this.deleteVehicle(vehicle.id);
        });
        
        return card;
    },
    
    // Filtrage des véhicules par texte de recherche
    filterVehicles: function(searchText) {
        searchText = searchText.toLowerCase();
        
        const cards = document.querySelectorAll('.vehicle-card');
        
        cards.forEach(card => {
            const title = card.querySelector('.vehicle-title').textContent.toLowerCase();
            const price = card.querySelector('.vehicle-price').textContent.toLowerCase();
            const details = card.querySelector('.vehicle-details').textContent.toLowerCase();
            
            const matches = title.includes(searchText) || 
                           price.includes(searchText) || 
                           details.includes(searchText);
            
            card.style.display = matches ? '' : 'none';
        });
    },
    
    // Filtrage des véhicules par type
    filterVehiclesByType: function(type) {
        const cards = document.querySelectorAll('.vehicle-card');
        
        cards.forEach(card => {
            const cardType = card.getAttribute('data-type');
            
            if (type === 'all' || cardType === type) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    },
    
    // Filtrage des véhicules par statut
    filterVehiclesByStatus: function(status) {
        const cards = document.querySelectorAll('.vehicle-card');
        
        cards.forEach(card => {
            const cardStatus = card.getAttribute('data-status');
            
            if (status === 'all' || cardStatus === status) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    },
    
    // Édition d'un véhicule
    editVehicle: function(vehicleId) {
        // Récupérer les données du véhicule
        const vehicle = LocalDataService.getVehicleById(vehicleId);
        if (!vehicle) {
            ToastManager.error("Erreur", "Véhicule non trouvé");
            return;
        }
        
        // Remplir le formulaire
        document.getElementById('vehicleType').value = vehicle.type || 'sale';
        document.getElementById('vehicleMake').value = vehicle.make || '';
        document.getElementById('vehicleModel').value = vehicle.model || '';
        document.getElementById('vehicleYear').value = vehicle.year || '';
        document.getElementById('vehiclePrice').value = vehicle.price || '';
        document.getElementById('vehicleMileage').value = vehicle.mileage || '';
        document.getElementById('vehicleFuel').value = vehicle.fuel || 'essence';
        document.getElementById('vehicleTransmission').value = vehicle.transmission || 'manual';
        document.getElementById('vehicleDescription').value = vehicle.description || '';
        
        // Réinitialiser l'état des images Cloudinary
        this.state.cloudinaryImages = [];
        
        // Changer le titre
        document.querySelector('#addVehicleModal .modal-title').textContent = 'Modifier un véhicule';
        
        // Configurer le bouton de sauvegarde
        const saveBtn = document.getElementById('saveVehicle');
        saveBtn.setAttribute('data-mode', 'edit');
        saveBtn.setAttribute('data-id', vehicleId);
        
        // Charger les images existantes
        this.loadExistingVehicleImages(vehicleId);
        
        // Afficher le modal
        document.getElementById('addVehicleModal').classList.add('active');
    },
    
    // Chargement des images existantes d'un véhicule pour l'édition
    loadExistingVehicleImages: function(vehicleId) {
        const vehicle = LocalDataService.getVehicleById(vehicleId);
        if (!vehicle || !vehicle.images || vehicle.images.length === 0) {
            // Pas d'images à charger
            return;
        }
        
        // Activer l'onglet "Sélectionner des images existantes"
        document.querySelectorAll('[data-image-tab]').forEach(tab => {
            if (tab.getAttribute('data-image-tab') === 'select') {
                tab.click();
            }
        });
        
        // Charger toutes les images et présélectionner celles du véhicule
        this.loadAvailableImages(vehicle.images);
    },
    
    // Suppression d'un véhicule
    deleteVehicle: function(vehicleId) {
        if (confirm("Êtes-vous sûr de vouloir supprimer ce véhicule ? Cette action est irréversible.")) {
            try {
                // Supprimer le véhicule
                const success = LocalDataService.deleteVehicle(vehicleId);
                
                if (success) {
                    // Mettre à jour l'affichage
                    document.querySelector(`.vehicle-card[data-id="${vehicleId}"]`).remove();
                    
                    // Afficher une notification
                    ToastManager.success("Succès", "Le véhicule a été supprimé avec succès");
                    
                    // Mettre à jour les statistiques
                    this.updateDashboardStats();
                } else {
                    ToastManager.error("Erreur", "Impossible de supprimer le véhicule");
                }
            } catch (error) {
                console.error("Erreur lors de la suppression du véhicule:", error);
                ToastManager.error("Erreur", "Une erreur est survenue lors de la suppression");
            }
        }
    },
    
    // Initialisation de la section réservations
    initReservationsSection: function() {
        // Configuration des onglets
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Mettre à jour l'onglet actif
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active');
                });
                btn.classList.add('active');
                
                // Filtrer les réservations par statut
                const status = btn.getAttribute('data-tab');
                this.filterReservationsByStatus(status);
            });
        });
        
        // Configuration de la recherche
        const searchInput = document.getElementById('reservation-search');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.filterReservations(e.target.value);
            });
        }
        
        // Basculer entre les vues liste et calendrier
        document.getElementById('list-view-btn').addEventListener('click', () => {
            document.getElementById('list-view-btn').classList.add('active');
            document.getElementById('calendar-view-btn').classList.remove('active');
            document.getElementById('list-view').classList.add('active');
            document.getElementById('calendar-view').classList.remove('active');
        });
        
        document.getElementById('calendar-view-btn').addEventListener('click', () => {
            document.getElementById('calendar-view-btn').classList.add('active');
            document.getElementById('list-view-btn').classList.remove('active');
            document.getElementById('calendar-view').classList.add('active');
            document.getElementById('list-view').classList.remove('active');
            
            // Générer le calendrier
            this.generateCalendar(new Date());
        });
        
        // Configurer le filtre de date
        document.getElementById('apply-date-filter').addEventListener('click', () => {
            const fromDate = document.getElementById('date-from').value;
            const toDate = document.getElementById('date-to').value;
            
            if (fromDate && toDate) {
                this.filterReservationsByDate(fromDate, toDate);
            } else {
                ToastManager.warning("Attention", "Veuillez sélectionner les deux dates");
            }
        });
    },
    
    // Chargement des réservations
    loadReservations: function() {
        const container = document.getElementById('reservations-table-container');
        if (!container) return;
        
        try {
            // Récupérer les réservations
            const reservations = LocalDataService.getReservations();
            this.state.reservations = reservations;
            
            if (reservations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px;">
                        <i class="fas fa-calendar-alt" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                        <p>Aucune réservation trouvée</p>
                    </div>
                `;
                return;
            }
            
            // Générer le tableau
            let html = `
                <table class="reservations-table">
                    <thead>
                        <tr>
                            <th>Référence</th>
                            <th>Client</th>
                            <th>Véhicule</th>
                            <th>Date début</th>
                            <th>Date fin</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            reservations.forEach((reservation, index) => {
                // Déterminer le statut de la réservation
                let status = reservation.status || 'pending';
                let statusText = 'En attente';
                
                if (status === 'confirmed') statusText = 'Confirmée';
                if (status === 'active') statusText = 'En cours';
                if (status === 'completed') statusText = 'Terminée';
                if (status === 'cancelled') statusText = 'Annulée';
                
                // Formatter les dates
                const startDate = reservation.startDate ? new Date(reservation.startDate).toLocaleDateString('fr-FR') : 'Non définie';
                const endDate = reservation.endDate ? new Date(reservation.endDate).toLocaleDateString('fr-FR') : 'Non définie';
                
                html += `
                    <tr data-status="${status}">
                        <td>#RES-${(index + 1).toString().padStart(3, '0')}</td>
                        <td>${reservation.fullName || 'Client'}</td>
                        <td>${reservation.vehicle || 'Véhicule'}</td>
                        <td>${startDate}</td>
                        <td>${endDate}</td>
                        <td><span class="status-badge ${status}">${statusText}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="action-btn view-reservation" title="Voir détails" data-id="${index}"><i class="fas fa-eye"></i></button>
                                ${status === 'pending' ? `<button class="action-btn confirm-reservation" title="Confirmer" data-id="${index}"><i class="fas fa-check"></i></button>` : ''}
                                ${status !== 'cancelled' && status !== 'completed' ? `<button class="action-btn cancel-reservation" title="Annuler" data-id="${index}"><i class="fas fa-times"></i></button>` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            // Mettre à jour le conteneur
            container.innerHTML = html;
            
            // Configurer les boutons d'action
            this.setupReservationButtons();
            
            // Générer le calendrier
            if (document.getElementById('calendar-view').classList.contains('active')) {
                this.generateCalendar(new Date());
            }
        } catch (error) {
            console.error("Erreur lors du chargement des réservations:", error);
            container.innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #f44336; margin-bottom: 15px;"></i>
                    <p>Erreur lors du chargement des réservations</p>
                </div>
            `;
        }
    },
    
    // Configuration des boutons de réservation
    setupReservationButtons: function() {
        // Boutons de visualisation
        document.querySelectorAll('.view-reservation').forEach(btn => {
            btn.addEventListener('click', () => {
                const index = parseInt(btn.getAttribute('data-id'));
                this.viewReservationDetails(index);
            });
        });
        
        // Boutons de confirmation
        document.querySelectorAll('.confirm-reservation').forEach(btn => {
            btn.addEventListener('click', () => {
                const index = parseInt(btn.getAttribute('data-id'));
                this.updateReservationStatus(index, 'confirmed');
            });
        });
        
        // Boutons d'annulation
        document.querySelectorAll('.cancel-reservation').forEach(btn => {
            btn.addEventListener('click', () => {
                const index = parseInt(btn.getAttribute('data-id'));
                this.updateReservationStatus(index, 'cancelled');
            });
        });
    },
    
    // Visualisation des détails d'une réservation
    viewReservationDetails: function(index) {
        const reservations = this.state.reservations;
        if (index < 0 || index >= reservations.length) return;
        
        const reservation = reservations[index];
        
        // Pour cet exemple, on affiche simplement une alerte avec quelques informations
        alert(`
            Détails de la réservation #RES-${(index + 1).toString().padStart(3, '0')}
            
            Client: ${reservation.fullName || 'Non spécifié'}
            Email: ${reservation.email || 'Non spécifié'}
            Téléphone: ${reservation.phone || 'Non spécifié'}
            
            Véhicule: ${reservation.vehicle || 'Non spécifié'}
            Dates: ${new Date(reservation.startDate).toLocaleDateString('fr-FR')} - ${new Date(reservation.endDate).toLocaleDateString('fr-FR')}
            
            Option: ${reservation.option === 'avec-chauffeur' ? 'Avec chauffeur' : 'Sans chauffeur'}
            Lieu de prise en charge: ${reservation.pickupLocation || 'Non spécifié'}
            
            Message: ${reservation.message || 'Aucun message'}
            Statut: ${reservation.status || 'En attente'}
        `);
        
        // Dans une version complète, vous pourriez ouvrir un modal avec ces informations
    },
    
    // Mise à jour du statut d'une réservation
    updateReservationStatus: function(index, newStatus) {
        const reservations = this.state.reservations;
        if (index < 0 || index >= reservations.length) return;
        
        // Message de confirmation
        const statusText = newStatus === 'confirmed' ? 'confirmer' : 'annuler';
        if (!confirm(`Êtes-vous sûr de vouloir ${statusText} la réservation #RES-${(index + 1).toString().padStart(3, '0')} ?`)) {
            return;
        }
        
        try {
            // Mettre à jour le statut
            reservations[index].status = newStatus;
            LocalDataService.setStorageData(LocalDataService.STORAGE_KEYS.RESERVATIONS, reservations);
            
            // Mettre à jour l'interface
            this.loadReservations();
            
            // Notification
            ToastManager.success("Succès", `La réservation a été ${newStatus === 'confirmed' ? 'confirmée' : 'annulée'} avec succès`);
        } catch (error) {
            console.error(`Erreur lors de la mise à jour du statut:`, error);
            ToastManager.error("Erreur", "Impossible de mettre à jour la réservation");
        }
    },
    
    // Filtrage des réservations par statut
    filterReservationsByStatus: function(status) {
        const rows = document.querySelectorAll('.reservations-table tbody tr');
        
        rows.forEach(row => {
            if (status === 'all' || row.getAttribute('data-status') === status) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    },
    
    // Filtrage des réservations par texte de recherche
    filterReservations: function(searchText) {
        searchText = searchText.toLowerCase();
        
        const rows = document.querySelectorAll('.reservations-table tbody tr');
        
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            let matches = false;
            
            cells.forEach(cell => {
                if (cell.textContent.toLowerCase().includes(searchText)) {
                    matches = true;
                }
            });
            
            row.style.display = matches ? '' : 'none';
        });
    },
    
    // Filtrage des réservations par date
    filterReservationsByDate: function(fromDate, toDate) {
        const rows = document.querySelectorAll('.reservations-table tbody tr');
        
        // Convertir les dates en objets Date
        const startDate = new Date(fromDate);
        const endDate = new Date(toDate);
        
        // Ajouter un jour à la date de fin pour inclure cette date
        endDate.setDate(endDate.getDate() + 1);
        
        rows.forEach(row => {
            const startDateCell = row.querySelectorAll('td')[3].textContent;
            const reservationDate = this.parseLocalDate(startDateCell);
            
            if (reservationDate >= startDate && reservationDate < endDate) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    },
    
    // Parser une date locale (format DD/MM/YYYY)
    parseLocalDate: function(dateStr) {
        if (dateStr === 'Non définie') return new Date(0);
        
        const parts = dateStr.split('/');
        if (parts.length !== 3) return new Date();
        
        return new Date(parts[2], parts[1] - 1, parts[0]);
    },
    
    // Génération du calendrier
    generateCalendar: function(date) {
        const calendarTitle = document.getElementById('calendar-title');
        const calendarDays = document.querySelector('.calendar-days');
        
        if (!calendarTitle || !calendarDays) return;
        
        // Définir le titre du calendrier
        const months = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
        calendarTitle.textContent = `${months[date.getMonth()]} ${date.getFullYear()}`;
        
        // Vider le calendrier
        calendarDays.innerHTML = '';
        
        // Obtenir le premier jour du mois
        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
        // Obtenir le dernier jour du mois
        const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
        
        // Convertir les jours pour commencer par lundi (1) et finir par dimanche (7)
        let firstDayOfWeek = firstDay.getDay();
        if (firstDayOfWeek === 0) firstDayOfWeek = 7; // Dimanche = 7
        
        // Ajouter les jours du mois précédent
        for (let i = 1; i < firstDayOfWeek; i++) {
            const previousMonthDay = new Date(date.getFullYear(), date.getMonth(), 1 - (firstDayOfWeek - i));
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = previousMonthDay.getDate();
            calendarDays.appendChild(dayElement);
        }
        
        // Ajouter les jours du mois actuel
        for (let i = 1; i <= lastDay.getDate(); i++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = i;
            
            // Marquer le jour actuel
            const currentDate = new Date();
            if (currentDate.getDate() === i && 
                currentDate.getMonth() === date.getMonth() && 
                currentDate.getFullYear() === date.getFullYear()) {
                dayElement.classList.add('today');
            }
            
            // Vérifier si ce jour a des réservations
            const hasEvents = this.checkDayForReservations(date.getFullYear(), date.getMonth(), i);
            if (hasEvents) {
                dayElement.classList.add('has-events');
            }
            
            calendarDays.appendChild(dayElement);
        }
        
        // Ajouter les jours du mois suivant pour compléter la grille
        const daysInGrid = calendarDays.children.length;
        const totalDaysNeeded = 42; // 6 semaines * 7 jours
        
        for (let i = 1; i <= totalDaysNeeded - daysInGrid; i++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = i;
            calendarDays.appendChild(dayElement);
        }
        
        // Configuration des boutons de navigation
        document.getElementById('prev-month').onclick = () => {
            const newDate = new Date(date.getFullYear(), date.getMonth() - 1, 1);
            this.generateCalendar(newDate);
        };
        
        document.getElementById('next-month').onclick = () => {
            const newDate = new Date(date.getFullYear(), date.getMonth() + 1, 1);
            this.generateCalendar(newDate);
        };
    },
    
    // Vérifier si un jour contient des réservations
    checkDayForReservations: function(year, month, day) {
        const reservations = this.state.reservations;
        const targetDate = new Date(year, month, day);
        
        // Convertir en date simple (sans heure) pour comparaison
        const targetDateString = targetDate.toISOString().split('T')[0];
        
        // Vérifier si une réservation commence ou se termine ce jour
        return reservations.some(reservation => {
            if (!reservation.startDate || !reservation.endDate) return false;
            
            const startDateString = new Date(reservation.startDate).toISOString().split('T')[0];
            const endDateString = new Date(reservation.endDate).toISOString().split('T')[0];
            
            return startDateString === targetDateString || endDateString === targetDateString;
        });
    },
    
    // Initialisation de la section paramètres
    initSettingsSection: function() {
        // Chargement des paramètres
        const settingsForm = document.getElementById('settings-form');
        
        if (settingsForm) {
            // Chargement des paramètres
            this.loadSettings();
            
            // Soumission du formulaire
            settingsForm.addEventListener('submit', (e) => {
                e.preventDefault();
                this.saveSettings();
            });
            
            // Réinitialisation des paramètres
            document.getElementById('resetSettings').addEventListener('click', () => {
                if (confirm('Êtes-vous sûr de vouloir réinitialiser les paramètres?')) {
                    this.resetSettings();
                }
            });
        }
    },
    
    // Chargement des paramètres
    loadSettings: function() {
        try {
            // Récupérer les paramètres
            const settings = LocalDataService.getSettings();
            
            // Remplir le formulaire
            document.getElementById('siteName').value = settings.siteName || 'Ndiambour Location';
            document.getElementById('currency').value = settings.currency || 'FCFA';
            document.getElementById('language').value = settings.language || 'fr';
            document.getElementById('contactEmail').value = settings.contactEmail || 'contact@ndiambourlocation.com';
            
            // Options d'affichage
            document.getElementById('showAvailabilityOnSite').checked = settings.showAvailabilityOnSite !== false;
            document.getElementById('enableOnlineReservation').checked = settings.enableOnlineReservation !== false;
            document.getElementById('enablePriceDisplay').checked = settings.enablePriceDisplay !== false;
        } catch (error) {
            console.error("Erreur lors du chargement des paramètres:", error);
            ToastManager.error("Erreur", "Impossible de charger les paramètres");
        }
    },
    
    // Sauvegarde des paramètres
    saveSettings: function() {
        try {
            // Récupérer les valeurs du formulaire
            const settings = {
                siteName: document.getElementById('siteName').value,
                currency: document.getElementById('currency').value,
                language: document.getElementById('language').value,
                contactEmail: document.getElementById('contactEmail').value,
                showAvailabilityOnSite: document.getElementById('showAvailabilityOnSite').checked,
                enableOnlineReservation: document.getElementById('enableOnlineReservation').checked,
                enablePriceDisplay: document.getElementById('enablePriceDisplay').checked
            };
            
            // Sauvegarder les paramètres
            LocalDataService.updateSettings(settings);
            
            // Afficher une notification
            ToastManager.success("Succès", "Les paramètres ont été enregistrés avec succès");
        } catch (error) {
            console.error("Erreur lors de la sauvegarde des paramètres:", error);
            ToastManager.error("Erreur", "Impossible d'enregistrer les paramètres");
        }
    },
    
    // Réinitialisation des paramètres
    resetSettings: function() {
        try {
            // Paramètres par défaut
            const defaultSettings = {
                siteName: 'Ndiambour Location',
                currency: 'FCFA',
                language: 'fr',
                contactEmail: 'contact@ndiambourlocation.com',
                showAvailabilityOnSite: true,
                enableOnlineReservation: true,
                enablePriceDisplay: true
            };
            
            // Sauvegarder les paramètres
            LocalDataService.updateSettings(defaultSettings);
            
            // Mettre à jour le formulaire
            this.loadSettings();
            
            // Afficher une notification
            ToastManager.success("Succès", "Les paramètres ont été réinitialisés");
        } catch (error) {
            console.error("Erreur lors de la réinitialisation des paramètres:", error);
            ToastManager.error("Erreur", "Impossible de réinitialiser les paramètres");
        }
    },
    
    // Configuration des modals
    setupModals: function() {
        // Fermeture des modals
        document.querySelectorAll('.modal-close, .btn-secondary').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
                
                // Réinitialiser l'état des images Cloudinary lors de la fermeture du modal
                this.state.cloudinaryImages = [];
            });
        });
        
        // Fermeture en cliquant à l'extérieur
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    
                    // Réinitialiser l'état des images Cloudinary lors de la fermeture du modal
                    this.state.cloudinaryImages = [];
                }
            });
        });
        
        // Configuration des onglets d'images
        document.querySelectorAll('[data-image-tab]').forEach(tab => {
            tab.addEventListener('click', () => {
                // Désactiver tous les onglets
                document.querySelectorAll('[data-image-tab]').forEach(t => {
                    t.classList.remove('active');
                });
                
                // Activer l'onglet cliqué
                tab.classList.add('active');
                
                // Masquer tous les contenus
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                
                // Afficher le contenu correspondant
                const tabType = tab.getAttribute('data-image-tab');
                if (tabType === 'upload') {
                    document.getElementById('upload-tab-content').style.display = 'block';
                } else if (tabType === 'select') {
                    document.getElementById('select-tab-content').style.display = 'block';
                    // Charger les images disponibles
                    this.loadAvailableImages();
                }
            });
        });
        
        // Configuration du bouton d'upload pour utiliser Cloudinary
        document.getElementById('vehiclePhotoUploadBtn').addEventListener('click', () => {
            // Ouvrir le widget d'upload Cloudinary
            CloudinaryService.openUploadWidget({}, (error, result) => {
                if (!error && result && result.event === "success") {
                    // Une image a été téléchargée avec succès
                    const imageInfo = result.info;
                    
                    // Stocker l'image Cloudinary dans l'état
                    this.state.cloudinaryImages.push({
                        public_id: imageInfo.public_id,
                        secure_url: imageInfo.secure_url,
                        original_filename: imageInfo.original_filename,
                        format: imageInfo.format,
                        width: imageInfo.width,
                        height: imageInfo.height,
                        bytes: imageInfo.bytes
                    });
                    
                    // Mettre à jour l'affichage
                    this.updateCloudinaryPhotoPreview();
                    
                    // Notification
                    ToastManager.success("Succès", "Image téléchargée avec succès");
                } else if (error) {
                    console.error("Erreur Cloudinary:", error);
                    ToastManager.error("Erreur", "Impossible de télécharger l'image");
                }
            });
        });
        
        // Sauvegarde d'un véhicule
        document.getElementById('saveVehicle').addEventListener('click', () => {
            this.saveVehicle();
        });
    },
    
    // Mise à jour de la prévisualisation des photos Cloudinary
    updateCloudinaryPhotoPreview: function() {
        const photoPreview = document.getElementById('vehiclePhotoPreview');
        const photoCounter = document.getElementById('photoCounter');
        
        if (!photoPreview) return;
        
        // Vider la prévisualisation
        photoPreview.innerHTML = '';
        
        // Mettre à jour le compteur
        if (photoCounter) {
            photoCounter.textContent = `${this.state.cloudinaryImages.length} photo${this.state.cloudinaryImages.length !== 1 ? 's' : ''} sélectionnée${this.state.cloudinaryImages.length !== 1 ? 's' : ''}`;
        }
        
        if (this.state.cloudinaryImages.length > 0) {
            photoPreview.style.display = 'flex';
            
            this.state.cloudinaryImages.forEach((image, index) => {
                // Créer l'élément de prévisualisation
                const previewItem = document.createElement('div');
                previewItem.className = 'photo-preview-item';
                
                // Générer une URL de miniature optimisée
                const thumbnailUrl = CloudinaryService.getThumbnailUrl(image.secure_url, 100, 100);
                
                // Créer l'image thumbnail
                const img = document.createElement('img');
                img.className = 'preview-thumbnail';
                img.src = thumbnailUrl;
                img.alt = image.original_filename;
                
                // Bouton de suppression
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-photo-btn';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.setAttribute('data-index', index);
                removeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    // Supprimer l'image de la liste
                    this.state.cloudinaryImages.splice(index, 1);
                    
                    // Mettre à jour l'affichage
                    this.updateCloudinaryPhotoPreview();
                });
                
                // Ajouter les éléments à l'item
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                
                // Ajouter l'item à la prévisualisation
                photoPreview.appendChild(previewItem);
            });
        } else {
            photoPreview.style.display = 'none';
        }
    },
    
    // Chargement des images disponibles pour le sélecteur
    loadAvailableImages: function(selectedImageIds = []) {
        const container = document.getElementById('available-images-container');
        if (!container) return;
        
        try {
            // Récupérer toutes les images
            const images = LocalDataService.getAllImages();
            
            if (images.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #777;">
                        <i class="fas fa-images" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Aucune image disponible</p>
                        <p>Utilisez l'onglet "Télécharger des photos" pour ajouter des images</p>
                    </div>
                `;
                return;
            }
            
            // Vider le conteneur
            container.innerHTML = '';
            
            // Afficher les images
            images.forEach(image => {
                const item = document.createElement('div');
                item.className = 'image-selector-item';
                item.setAttribute('data-id', image.id);
                item.style.position = 'relative';
                item.style.cursor = 'pointer';
                
                // Vérifier si c'est une image Cloudinary pour l'optimisation
                const thumbnailUrl = image.src.includes('cloudinary.com') 
                    ? CloudinaryService.getThumbnailUrl(image.src) 
                    : image.src;
                
                item.innerHTML = `
                    <img src="${thumbnailUrl}" alt="${image.alt || image.fileName}" style="width: 100%; height: 70px; object-fit: cover; border-radius: 5px;">
                    <div class="image-checkbox" style="position: absolute; top: 5px; right: 5px; width: 20px; height: 20px; background: white; border-radius: 3px; display: flex; align-items: center; justify-content: center;"></div>
                `;
                
                // Présélectionner l'image si elle est dans le tableau des IDs sélectionnés
                if (selectedImageIds.includes(image.id)) {
                    const checkbox = item.querySelector('.image-checkbox');
                    checkbox.classList.add('checked');
                    checkbox.innerHTML = '<i class="fas fa-check" style="color: #1565C0; font-size: 12px;"></i>';
                }
                
                // Configurer le clic pour sélectionner
                item.addEventListener('click', () => {
                    const checkbox = item.querySelector('.image-checkbox');
                    if (checkbox.classList.contains('checked')) {
                        checkbox.classList.remove('checked');
                        checkbox.innerHTML = '';
                    } else {
                        checkbox.classList.add('checked');
                        checkbox.innerHTML = '<i class="fas fa-check" style="color: #1565C0; font-size: 12px;"></i>';
                    }
                    
                    // Mettre à jour la sélection
                    this.updateSelectedImages();
                });
                
                container.appendChild(item);
            });
            
            // Mettre à jour l'affichage des images sélectionnées
            this.updateSelectedImages();
        } catch (error) {
            console.error("Erreur lors du chargement des images:", error);
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #777;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <p>Erreur lors du chargement des images</p>
                </div>
            `;
        }
    },
    
    // Mettre à jour les images sélectionnées
    updateSelectedImages: function() {
        const selectedImagesContainer = document.getElementById('selected-images');
        if (!selectedImagesContainer) return;
        
        // Récupérer les éléments sélectionnés
        const selectedItems = document.querySelectorAll('.image-selector-item .image-checkbox.checked');
        
        if (selectedItems.length === 0) {
            selectedImagesContainer.innerHTML = `
                <div class="empty-selection" style="width: 100%; text-align: center; padding: 15px; color: #777; font-style: italic;">
                    Aucune image sélectionnée
                </div>
            `;
            return;
        }
        
        // Vider le conteneur
        selectedImagesContainer.innerHTML = '';
        
        // Afficher les images sélectionnées
        selectedItems.forEach(checkbox => {
            const item = checkbox.closest('.image-selector-item');
            const imageId = item.getAttribute('data-id');
            const image = LocalDataService.getImageById(imageId);
            
            if (!image) return;
            
            const thumbnail = document.createElement('div');
            thumbnail.className = 'selected-thumbnail';
            thumbnail.setAttribute('data-id', imageId);
            thumbnail.style.position = 'relative';
            thumbnail.style.width = '80px';
            thumbnail.style.height = '60px';
            thumbnail.style.marginBottom = '10px';
            
            // Utiliser une URL optimisée pour les images Cloudinary
            const thumbnailUrl = image.src.includes('cloudinary.com') 
                ? CloudinaryService.getThumbnailUrl(image.src, 80, 60) 
                : image.src;
            
            thumbnail.innerHTML = `
                <img src="${thumbnailUrl}" alt="${image.alt || image.fileName}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 5px;">
                <button class="remove-selected" title="Supprimer" style="position: absolute; top: 3px; right: 3px; width: 18px; height: 18px; border-radius: 50%; background: rgba(0,0,0,0.6); color: white; border: none; display: flex; align-items: center; justify-content: center; font-size: 10px; cursor: pointer;"><i class="fas fa-times"></i></button>
            `;
            
            // Configurer le bouton de suppression
            thumbnail.querySelector('.remove-selected').addEventListener('click', (e) => {
                e.stopPropagation();
                
                // Désélectionner l'image dans le sélecteur
                checkbox.classList.remove('checked');
                checkbox.innerHTML = '';
                
                // Mettre à jour l'affichage
                this.updateSelectedImages();
            });
            
            selectedImagesContainer.appendChild(thumbnail);
        });
    },
    
    // Sauvegarde d'un véhicule
    saveVehicle: function() {
        // Récupérer les valeurs du formulaire
        const type = document.getElementById('vehicleType').value;
        const make = document.getElementById('vehicleMake').value;
        const model = document.getElementById('vehicleModel').value;
        const year = document.getElementById('vehicleYear').value;
        const price = document.getElementById('vehiclePrice').value;
        const mileage = document.getElementById('vehicleMileage').value;
        const fuel = document.getElementById('vehicleFuel').value;
        const transmission = document.getElementById('vehicleTransmission').value;
        const description = document.getElementById('vehicleDescription').value;
        
        // Validation simple
        if (!make || !model || !price) {
            ToastManager.error("Erreur", "Veuillez remplir tous les champs obligatoires (marque, modèle, prix)");
            return;
        }
        
        // Déterminer le mode (ajout ou édition)
        const saveBtn = document.getElementById('saveVehicle');
        const mode = saveBtn.getAttribute('data-mode') || 'add';
        const vehicleId = saveBtn.getAttribute('data-id');
        
        try {
            // Créer la liste des images associées au véhicule
            let imageIds = [];
            
            // 1. Récupérer les images existantes sélectionnées
            const selectedThumbnails = document.querySelectorAll('#selected-images .selected-thumbnail');
            if (selectedThumbnails.length > 0) {
                imageIds = Array.from(selectedThumbnails).map(thumb => thumb.getAttribute('data-id'));
            }
            
            // 2. Traiter les images Cloudinary nouvellement téléchargées
            if (this.state.cloudinaryImages.length > 0) {
                ToastManager.info("Information", "Enregistrement des images...");
                
                // Pour chaque image Cloudinary, créer une entrée dans la base de données
                for (const cloudinaryImage of this.state.cloudinaryImages) {
                    // Créer un objet image à partir des données Cloudinary
                    const imageData = {
                        fileName: cloudinaryImage.original_filename,
                        fileType: cloudinaryImage.format.toUpperCase(),
                        category: 'vehicles',
                        alt: cloudinaryImage.original_filename,
                        src: cloudinaryImage.secure_url,
                        size: this.formatFileSize(cloudinaryImage.bytes) || 'Unknown',
                        dimensions: `${cloudinaryImage.width} × ${cloudinaryImage.height}`,
                        publicId: cloudinaryImage.public_id,
                        isCloudinary: true,
                        dateAdded: new Date().toISOString()
                    };
                    
                    // Ajouter l'image à la base de données
                    const newImage = LocalDataService.addImage(imageData);
                    
                    // Ajouter l'ID de l'image à la liste
                    imageIds.push(newImage.id);
                }
            }
            
            // Créer l'objet véhicule
            const vehicleData = {
                type,
                make,
                model,
                year,
                price,
                mileage,
                fuel,
                transmission,
                description,
                images: imageIds,
                status: 'available',
                dateAdded: new Date().toISOString()
            };
            
            // Ajouter ou mettre à jour le véhicule
            if (mode === 'add') {
                const newVehicle = LocalDataService.addVehicle(vehicleData);
                ToastManager.success("Succès", "Le véhicule a été ajouté avec succès");
            } else {
                const updatedVehicle = LocalDataService.updateVehicle(vehicleId, vehicleData);
                ToastManager.success("Succès", "Le véhicule a été mis à jour avec succès");
            }
            
            // Réinitialiser l'état des images Cloudinary
            this.state.cloudinaryImages = [];
            
            // Fermer le modal
            document.getElementById('addVehicleModal').classList.remove('active');
            
            // Recharger les véhicules
            this.loadVehicles();
            
            // Mettre à jour les statistiques du tableau de bord
            this.updateDashboardStats();
        } catch (error) {
            console.error("Erreur lors de la sauvegarde du véhicule:", error);
            ToastManager.error("Erreur", "Une erreur est survenue lors de la sauvegarde");
        }
    },
    
    // Formater la taille d'un fichier
    formatFileSize: function(bytes) {
        if (bytes === undefined || bytes === null) return 'Inconnu';
        if (bytes === 0) return '0 Bytes';
        
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }
};

// Initialiser l'application quand le DOM est chargé
document.addEventListener('DOMContentLoaded', () => {
    AdminManager.init();
});
    </script>
    </html>